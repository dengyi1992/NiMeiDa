(function(window,document,Zepto,$){define("componentsPath/form/latest_version/components/form/portal",["zepto"],function(e){return{freshCode:function(t){e(t).find("#crow-form-v-img").attr("src","http://www.kuaizhan.com/passport/vcode")},clearUserInput:function(t){e(t).find("#crow-form-vcode-input").val("");var n=e(t).find(".crow-form-box");for(var r=0;r<n.length;r++){var i=e(n[r]).find("input"),s=e(n[r]).find("textarea");i.length!=0&&i.val(""),s.length!=0&&s.val("")}},onAfterRender:function(t){var n=SOHUZ.page.site_id,r="/plugin/api-proxy/form/kz_form/api/answer?site_id="+n,i="http://www.kuaizhan.com/passport/ajax-validate-vcode?vcode=",s=this;e(t).find("#crow-form-error").hide(),e(t).find("#crow-form-success").hide(),e(t).find("#crow-form-failure").hide(),e(t).find("#crow-form-v-unmatch").hide(),e(t).find("#crow-form-v-error").hide(),e(t).find("#crow-form-v-img").on("click",function(){s.freshCode(t)}),e(t).find("#crow-form-submit").on("click",function(){var i=e(t).data("items"),o=e(t).data("title"),u=e(t).data("id"),a=e(t).find(".crow-form-box");for(var f=0;f<i.length;f++){if(e(a[f]).find("input").length==0)var l=e.trim(e(a[f]).find("textarea").val());else var l=e.trim(e(a[f]).find("input").val());if(i[f].is_required&&l.length==0){e(t).find("#crow-form-failure").hide(),e(t).find("#crow-form-success").hide(),e(t).find("#crow-form-v-error").hide(),e(t).find("#crow-form-v-unmatch").hide(),e(t).find("#crow-form-error").show();return}i[f].answer=l}SOHUZ.kaq&&SOHUZ.kaq("send","event","system_plugin","click","form",1),e.ajax({type:"POST",url:r,data:{site_id:n,form_id:u,title:o,items:JSON.stringify(i)},success:function(){e(t).find("#crow-form-error").hide(),e(t).find("#crow-form-v-error").hide(),e(t).find("#crow-form-failure").hide(),e(t).find("#crow-form-v-unmatch").hide(),e(t).find("#crow-form-success").show(),s.freshCode(t),s.clearUserInput(t)},error:function(){s.freshCode(t),e(t).find("#crow-form-error").hide(),e(t).find("#crow-form-v-error").hide(),e(t).find("#crow-form-success").hide(),e(t).find("#crow-form-v-unmatch").hide(),e(t).find("#crow-form-failure").show()}})})}}}),define("componentsPath/html/latest_version/components/html/portal",[""],function(){return{onAfterRender:function(e){}}}),define("componentsPath/js/latest_version/components/js/portal",[""],function(){return{onAfterRender:function(e){}}}),define("componentsPath/system_plugin/latest_version/components/commodity-list/portal",["zepto"],function(e){var t="http://7bede40ef4e00.cdn.sohucs.com/a68ff48b28935270ddab52e427f11a18",n='<div class="mod-commodity-item"><a class="item-top"><div class="item-con clearfix"><div class="commodity-item-img"><img src="http://kzcdn.itc.cn/res/skin/images/empty.gif" /></div><div class="commodity-item-detail"><div class="item-title-wrp clearfix"><div class="commodity-item-title"></div></div><div class="commodity-item-price clearfix"><span class="item-desc-c"></span><span class="item-price-c"></span><span class="item-multi-models"></span><i class="item-btn-add" data-role="add-tag"><img width="100%" height="100%" src="http://pic.kuaizhan.com/g1/M01/5E/B0/wKjmqVag2PmABy8FAAAGBB3mfJQ5909929/imageView/v1/thumbnail/640x0" /></i></div></div></div></a></div>',r='<div class="commodity-content-small" style="display: none"><div class="info-div"><div class="p-info">已加入购物车</div><div class="button-div"><a class="confirm-msg-btn" value="确定">确定</a></div></div></div>',i='<div class="commodity-black-overlay" style="display: none"></div>',s=function(n){e.ajax({url:"/shop/api/shops/"+n.shop_id+"/commodities?is_online=true&category_id="+n.category_id+"&offset="+n.count_order_type*n.order_type,type:"GET",cache:!1,dataType:"json",success:function(e){n.callback(e)}})},o=function(n){e.ajax({url:"shop/api/my-wishes",type:"POST",data:n.data,dataType:"json",success:function(e){n.success(e)},error:function(e){n.error(e)}})},u=function(n,r,i,s){n.attr("commodity-id",r._id),n.find(".commodity-item-title").html(r.title),n.find(".item-price-c").html("已售"+r.sales_volume+"件"),r.enable_score&&r.only_use_score?(n.find(".item-desc-c").html(r.price*s+"积分"),n.find(".commodity-item-title").addClass("icon-score")):r.type==200?(n.find(".item-desc-c").html("¥"+r.group_price),n.find(".commodity-item-title").addClass("icon-group")):(n.find(".item-desc-c").html("¥"+r.price),r.type==300&&n.find(".commodity-item-title").addClass("icon-coupon"));var o=r.attachments[0].url?r.attachments[0].url:t;n.find(".commodity-item-img img").attr("src",o+"/imageView/v1/thumbnail/304x304"),n.find(".item-top").attr("href","/shop/commodity/"+r._id),i==1&&r.models.length==0&&r.type!=200?(n.find(".commodity-item-price").find(".item-btn-add").show(),n.find(".commodity-item-price").find(".item-multi-models").remove()):n.find(".commodity-item-price").find(".item-btn-add").hide(),i==1&&r.models.length>0&&r.type==100?n.find(".commodity-item-price").find(".item-multi-models").html("多规格"):n.find(".commodity-item-price").find(".item-multi-models").html("")};return{onAfterRender:function(t){function S(){w.css("display","none"),E.css("display","none")}function x(){d.delegate(".item-btn-add","click",function(){var t=e(this).closest("div.mod-commodity-item").attr("commodity-id"),n=1,r={commodity_id:t,models:"{}",amount:n};return e.ajax({url:"/shop/api/my-wishes",type:"POST",data:r,dataType:"json",success:function(t){e("body").append(w),e("body").append(E),w.css("display","block"),E.css("display","block");var n=w.width(),r=w.height(),i="-"+n/2+"px",s="-"+r/2+"px";w.css("margin-top",s),w.css("margin-left",i),console.log(t)},error:function(e){console.log(e),e.status==400&&b()}}),!1})}function T(){v[0].addEventListener("touchstart",function(t){o.touch_s=e.extend({},t.touches[0])},!1),v[0].addEventListener("touchmove",function(e){e.stopPropagation(),e.preventDefault(),o.touch_e=e.touches[0]},!1),v[0].addEventListener("touchend",function(){if(!o.touch_e&&!o.is_touch){setTimeout(function(){L()},300);return}var n=o.touch_e;o.touch_s&&o.touch_e&&(o.touch_s.clientX-n.clientX>40?(o._x=o._x-(o.touch_s.clientX-n.clientX),o._x<e("body").width()-v.width()&&(o._x=e("body").width()-v.width()),e(t).find(".group-list-div").css({transform:"translate("+o._x+"px,"+o._y+"px)","-webkit-transform":"translate("+o._x+"px,"+o._y+"px)","transition-duration":"400ms"})):o.touch_s.clientX-n.clientX<-40?(o._x=o._x-(o.touch_s.clientX-n.clientX),o._x>0&&(o._x=0),e(t).find(".group-list-div").css({transform:"translate("+o._x+"px,"+o._y+"px)","-webkit-transform":"translate("+o._x+"px,"+o._y+"px)","transition-duration":"400ms"})):Math.abs(o.touch_s.clientX-n.clientX)<10&&setTimeout(function(){L()},300)),o.touch_e=null,o.touch_s=null,o.is_touch=!1},!1)}function N(){v.delegate("li","click",function(){v.find(".cur").removeClass("cur"),e(this).closest("li").addClass("cur");var n=e(this).closest("li").data("value");y=0,s({shop_id:l,category_id:n==("all"||"undefined")?"":n,count_order_type:y,order_type:f,callback:function(n){g.html(""),e(t).find(".mod-commodity-more").remove();if(n.length==0){g.append(e('<div style="width:100%; text-align: center;height: 70px;line-height: 70px;background-color: #fff;color: #1253d7;">暂无商品信息</div>'));return}p==5?O(n):(O(n),n.length>f&&(d.append(e('<div class="mod-commodity-more"><span class="mod-commodity-more-t">显示更多</span><span class="mod-commodity-more-i"></span></div>')),e(t).find(".mod-commodity-more").click(M))),y++}})})}function C(){m.delegate("li","click",function(){m.find(".cur").removeClass("cur"),e(this).closest("li").addClass("cur");var n=e(this).closest("li").data("value"),r=e(this).closest("li").text();y=0,s({shop_id:l,category_id:n==("all"||"undefined")?"":n,count_order_type:y,order_type:f,callback:function(n){g.html(""),e(t).find(".mod-commodity-more").remove();if(n.length==0){g.append(e('<div style="width:100%; text-align: center;height: 70px;line-height: 70px;background-color: #fff;color: #d70c18;">暂无商品信息</div>')),e(t).find(".mod-commodity-title").html(r);return}O(n),e(t).find(".mod-commodity-title").html(r),n.length>f&&(d.append(e('<div class="mod-commodity-more"><span class="mod-commodity-more-t">显示更多</span><span class="mod-commodity-more-i"></span></div>')),e(t).find(".mod-commodity-more").click(M)),e(t).find(".mod-commodity-more").css("background-color","#f7f7f7").css("border","1px solid #f0f0f0").css("margin-top","-4px"),y++}})})}function k(){var n,r,i,s,u,a;e(t).on("touchstart",function(t){o.touch_start=e.extend({},t.touches[0]),o.startTime=(new Date).getTime(),n=t.targetTouches[0].screenX,r=t.targetTouches[0].screenY,u=!0,a=!0}),e(t).on("touchmove",function(e){o.touch_end=e.touches[0],i=e.targetTouches[0].screenX,s=e.targetTouches[0].screenY,u&&Math.abs(i-n)-Math.abs(s-r)>0?(e.stopPropagation(),e.preventDefault(),a=!1):a&&Math.abs(i-n)-Math.abs(s-r)<0&&(u=!1)}),e(t).on("touchend",function(){if(!o.touch_end&&!o.istouch){setTimeout(function(){L()},300);return}var n=o.touch_end;o.touch_start&&o.touch_end&&(o.touch_start.clientX-n.clientX>40?(o.trans_x=o.trans_x-(o.touch_start.clientX-n.clientX),o.trans_x<e("body").width()-g.width()&&(o.trans_x=e("body").width()-g.width()),e(t).find(".mod-commodity-item").css({transform:"translate("+o.trans_x+"px,"+o.trans_y+"px)","-webkit-transform":"translate("+o.trans_x+"px,"+o.trans_y+"px)","transition-duration":"400ms"})):o.touch_start.clientX-n.clientX<-40?(o.trans_x=o.trans_x-(o.touch_start.clientX-n.clientX),o.trans_x>0&&(o.trans_x=0),e(t).find(".mod-commodity-item").css({transform:"translate("+o.trans_x+"px,"+o.trans_y+"px)","-webkit-transform":"translate("+o.trans_x+"px,"+o.trans_y+"px)","transition-duration":"400ms"})):Math.abs(o.touch_start.clientX-n.clientX)<10&&Math.abs(o.touch_start.clientY-n.clientY)<10&&setTimeout(function(){L()},300)),o.touch_end=null,o.touch_start=null,o.istouch=!1})}function L(){window.location.hash=="#showImage"?window.history.back():window.location.hash=""}function A(){if(a==("all"||"undefined")&&p!=6){var n=0;v.find(".group-list-div").each(function(){n+=e(this).width()}),v.css("width",n).css("min-width",e("body").width())}s({shop_id:l,category_id:a==("all"||"undefined")?"":a,count_order_type:y,order_type:f,callback:function(n){g.html("");if(n.length==0){g.append(e('<div style="width:100%; text-align: center;height: 70px;line-height: 70px;background-color: #fff;color: #1253d7;">暂无商品信息</div>'));return}switch(p){case 6:O(n),n.length>f&&(d.append(e('<div class="mod-commodity-more"><span class="mod-commodity-more-t">显示更多</span><span class="mod-commodity-more-i"></span></div>')),e(t).find(".mod-commodity-more").click(M)),e(t).find(".mod-commodity-more").css("background-color","#f7f7f7").css("border","1px solid #f0f0f0").css("margin-top","-4px");break;case 5:O(n);break;case 4:case 3:case 2:default:O(n),n.length>f&&(d.append(e('<div class="mod-commodity-more"><span class="mod-commodity-more-t">显示更多</span><span class="mod-commodity-more-i"></span></div>')),e(t).find(".mod-commodity-more").click(M))}y++}})}function O(r){r.length<=f&&e(t).find(".mod-commodity-more").remove();switch(p){case 6:g.css("min-height",m.height()-30);for(var i=0,s=f<r.length?f:r.length;i<s;i++){var o=e(n);o.addClass("commodity-item-style"+p),o.attr("data-val",JSON.stringify(r[i])),u(o,r[i],h,c),g.append(o)}break;case 5:g.css("width",(f<r.length?f:r.length)*87).css("min-width",e("body").width());for(var i=0,s=f<r.length?f:r.length;i<s;i++){var o=e(n);o.addClass("commodity-item-style"+p),u(o,r[i],h,c),g.append(o),o.find(".item-price-c").width()+o.find(".item-multi-models").width()>78&&o.find(".item-multi-models").remove(),o.find(".item-price-c").width()+o.find(".item-btn-add").width()>78&&o.find(".item-btn-add").hide()}break;case 4:for(var i=0,s=f<r.length?f:r.length;i<s;i++){var o=e(n);i%3==0?o.addClass("commodity-item-style2"):(o.addClass("commodity-item-style3"),i%3==1&&o.addClass("left")),u(o,r[i],h,c),g.append(o)}break;case 3:for(var i=0,s=f<r.length?f:r.length;i<s;i++){var o=e(n);o.addClass("commodity-item-style"+p),i%2==0&&o.addClass("left"),u(o,r[i],h,c),g.append(o),o.find(".item-desc-c").width()+o.find(".item-price-c").width()+o.find(".item-multi-models").width()>137&&o.find(".item-multi-models").remove(),o.find(".item-desc-c").width()+o.find(".item-price-c").width()+o.find(".item-btn-add").width()>137&&o.find(".item-btn-add").hide()}break;case 2:for(var i=0,s=f<r.length?f:r.length;i<s;i++){var o=e(n);o.addClass("commodity-item-style"+p),u(o,r[i],h,c),g.append(o)}break;default:for(var i=0,s=f<r.length?f:r.length;i<s;i++){var o=e(n);u(o,r[i],h,c),g.append(o)}}}function M(){var e;p==6?e=m.find(".cur").data("value"):e=v.find(".cur").data("value")?v.find(".cur").data("value"):a,s({shop_id:l,category_id:e=="all"?"":e,count_order_type:y,order_type:f,callback:function(e){O(e),y++}})}var o=this,a=e(t).data("group_id"),f=Number(e(t).data("order_type")),l=e(t).data("shop_id"),c=Number(e(t).data("score_to_one_yuan")),h=e(t).data("shopping_cart"),p=e(t).data("type"),d=e(t).find(".mod-commodity-content"),v=e(t).find(".mod-commodity-top-list"),m=e(t).find(".mod-commodity-side-list"),g=e(t).find(".mod-commodity-itemList"),y=0;A(),x(),d.delegate(".item-top","click",function(){kaq&&(kaq("create",SOHUZ.page.site_id),kaq("send","event","system_plugin","click","commodity-list",1))});var b=function(){location.href=SOHUZ.CONF.url_passport+"/main/login?site_id="+SOHUZ.page.site_id+"&callback="+encodeURIComponent(window.location.href)},w=e(r),E=e(i);w.find(".info-div .confirm-msg-btn").click(function(){S()}),E.click(function(){S()});switch(p){case 6:C();break;case 5:o.trans_x=0,o.trans_y=0,k(),o._x=0,o._y=0,T(),N();break;case 4:case 3:case 2:default:o._x=0,o._y=0,T(),N()}}}}),define("componentsPath/system_plugin/latest_version/components/text/portal",[""],function(){return{onAfterRender:function(e){}}}),define("componentsPath/system_plugin/latest_version/components/guide-follow/portal",["zepto"],function(e){return{onAfterRender:function(t,n){function p(){var t=e(".wx-menu-item .follow-jump"),n=t.width();t.find(".appmsg-title").css("max-width",n-51-84-5)}function d(){e(".wx-menu-item.btn-wx-follow").show(),p(),o=="1"&&setTimeout(m,parseInt(a)*1e3)}function v(){s=="1"?setTimeout(d,parseInt(u)*1e3):d()}function m(){e(".wx-menu-item.btn-wx-follow").hide()}function g(){e.ajax({url:"/club/apiv1/me",type:"GET",dataType:"json",success:function(e){e&&typeof e.thirdpart_wx_acc_openid!="undefined"&&typeof e.site_id!="undefined"?y(e.thirdpart_wx_acc_openid,e.site_id):v()},error:function(){v()}})}function y(t,n){e.ajax({url:"/api-bridge/weixin/ajax-subscribe-check-by-open-id",type:"POST",data:{site_id:n,scene_type:3,open_id:t},dataType:"json",success:function(e){(e.ret!=0||!e.data.is_subscriber)&&v()},error:function(){v()}})}var r=e(".wx-plugin-menu"),i=/micromessenger/ig.test(n.navigator.userAgent);e(".wx-menu-item .follow-jump").css("top",-43),e(".wx-menu-item .close-guide-follow").css("top",-53),e(".kz-float-layer.bottom").length>0?(e(".kz-float-layer.bottom").prepend(r.html()),r.html(""),e(".kz-float-layer.bottom").parents(".kzpc-main").length>0&&(e(".wx-menu-item .follow-jump").css("top",-91),e(".wx-menu-item .close-guide-follow").css("top",-101))):(e(".wx-menu-item .follow-jump").css("top",""),e(".wx-menu-item .follow-jump").css("bottom",0),e(".wx-menu-item .close-guide-follow").css("top",""),e(".wx-menu-item .close-guide-follow").css("bottom",33));var s=e(".wx-menu-item.btn-wx-follow").data("set-delay"),o=e(".wx-menu-item.btn-wx-follow").data("set-standing"),u=e(".wx-menu-item.btn-wx-follow").data("delay"),a=e(".wx-menu-item.btn-wx-follow").data("standing"),f=e(".wx-menu-item.btn-wx-follow").data("follow-type"),l=e(".wx-menu-item.btn-wx-follow").data("follow-link"),c=e(".wx-menu-item.btn-wx-follow").data("qrcode"),h=e(".wx-menu-item.btn-wx-follow").data("check-subscribe");i&&(h=="1"?g():v()),e(n).resize(function(e){p()}),e(".wx-menu-item.btn-wx-follow").on("click",".follow-jump",function(){f=="2"?e(".mod-wx-follow-plugin .guide-attention-qr-code").show():n.location.href=l}),e(".mod-wx-follow-plugin .guide-attention-qr-code ").on("click",function(){e(this).hide()}),e(".mod-wx-follow-plugin .guide-attention-qr-code .content-wrapper").on("click",function(e){var t=n.event||e;t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}),e(".wx-menu-item.btn-wx-follow").on("click",".close-guide-follow",function(t){e(".wx-menu-item.btn-wx-follow").css("display","none")})}}}),define("componentsPath/system_plugin/latest_version/components/share/portal",["zepto"],function(e){return{onAfterRender:function(t){var n=navigator.userAgent.toLowerCase(),r=navigator.platform,i=e(t).find(".weixin"),s=e("body");if(n.match(/MicroMessenger/i)=="micromessenger"){var o='<div class="mod-shareweixin">                                <div class="tip">                                    <img class="tip-pyq" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAArCAYAAADhXXHAAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NTc3MiwgMjAxNC8wMS8xMy0xOTo0NDowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjQxMTY2M0ExOUFFRjExRTRCQTQ0QThDQjQ2ODczMTM4IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjQxMTY2M0EyOUFFRjExRTRCQTQ0QThDQjQ2ODczMTM4Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NDExNjYzOUY5QUVGMTFFNEJBNDRBOENCNDY4NzMxMzgiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NDExNjYzQTA5QUVGMTFFNEJBNDRBOENCNDY4NzMxMzgiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4sqKSRAAAMzklEQVR42rRZCZAU1Rn+XvdMd8/s7Cy7wC7rAivnghrkCgliqjRSiYmColQ8EBQqHuWFUYlEjUcFo0ZTCmoIotyIViUkEkQjGikMInKKsHLIzYIIy7K7c890v3yvZwb2mNnFxHTXv9v7+vV73/v/7z/eWyGlRNNL/Z1tE0K4km1Xz9nebA06UvZg20A+D2JTfzhOF+nYAXbW2e5A0xqh6cf4bidlC7/dxL57+NyQHQ/uiIKfOjnna3qJ/wJsT/55OVtHy0RsuDx5POg01sM5XgN5qhZOuBFIJiF0HcJfCNGhBKJzOfSSMojCopDwFXzK75dzvBUcb/f/C6zS4vV8nOA0HuonNR1aKoDIa79DatcXEF4DsG1X5ekfmXHV96YJESyB3rUnPH0GQK+idOmmNLyA/Zaw0+7vEuw4yn1O+OjQxIFVSNasBnQTvqGTgUMNiC54DrLxFAEVnwF5ekDHXYSktpGMu689/QdAjn8MDTEfysvlFs40nWDncy75v4AtojzGxzsS+/7pj+9ZDrt+P19o7GhDK+6FgosfAQ4S8NxpcBrqIAoCrfCe1rC6YjGYZR1x4ro/YM5rPlT1tXH1jVbca4jZnPcJzlebD6yG/FdXdl4gY3X3Rza86I9sngm74SCEEaCQi2YR7Lo9iPx7GtCtENbEhyGKSiCjkdyjKQUo0TQInx+6R8PJbxwsXRTHzGfD5teH7bs532L27JEPUD6wFZqmzbcbD40OrXsWiYP/ou1MF6Sr1YzqNEMB3ofImqcgKgLwT3gIWqADEI+1oQPp3kpr/oCAzy/w+QYbLz8dwa7q5E/ZYWE+wLnABgl0ph06/OPwuudgn9xB5wkSo6c1H2klYQVhn9rvAsY5flgTpkAEgkCiDcCueUVW0QgUCnxzVGL281Hs3JYcwZevUjq2B9bLFT/pxOtGRTdOJwdpdm9AMbstRZESBNxwCJG1T0OcUwDf+Clu2EIsfIarLcGK5msnM1B/Cpj3cgw1B1IjiYOrh9EMbNahMk41VtqJX8a+mINU7U6aveB00G5TlDNYpEToCMJrnyHbC+EjJYSP+SHc0AqwcE0issY5TWkF+Bg1vHhWDOFGOYHNN+XTbDfKw4l9KwKJ/R/wjc6Qw3BjJyjxdoR9kjEmAovWOIDQmifJegvWLQRcUAgZagJYrU3LgpXNiKUA+wm4emsK7y5lXAN+Q+nVEqxKjzfToS6I713Bwbyc2JcGrLjapnjPiGDWMosZc48hsu55iMpiWOMfBAqC1HAoDVDRpomOWpJETWkYGj5emVQO15tNExU91TuPm0Kl7M4xbtGMTigYMjXNegi0f/ErJ87vndZvUhFSXYf3fJYNN96F6BsvQ5LDQvdk2KOlE0aOIX3UU32dxOr3kji3p+cWwxKL+GaHJx37xc8du66XndjM1MiliRye3zIMyBR7pOAtGMIBOrjhnrJRDaoKFYpfmZCjDPNeODzI5I/YWzMzHNba1oHK0AS8dWMS+74yKqou8Ixi6y6Fim6L0anQJ4h88xIn9rUzGEdyki5Yo3g0wY5Ikmt/p3anc9GbKMmsV9JiOuU8WuoO76AR4+iGBbFF09NpV+S3nOKuaQnUn5TYuDaJ3v08o2iQ2QpsD+mEf5iMbCEMD3EyVMHJC1TKuKt5q+M4GCW/aCSsR/liRp4PUhSaC7eznFxlDLroBQItw+aVnMJuMwyr18mURKjOQSopv697RJUCO1im6oJObI8KmG2YXyPFyDk6kdlpIswOV9rUwG/bANryWsJiJeEdduk80bVbQKYy6TcHUFXzhBoc/OgSL66aYCGlw2LAHaLsPTCVPMqVsAjRvG0AbeRAJqzOtyugcCSW0fQzlHPlcrA8118pc3AOndxjtdKuAppgFAyHHFx+hYFJv/Lj7YMJfLgzodY1WLlklUweTpsXuRyLpnfquZACFJRNhhEcqRr5tTO9HS9sUiU6p7XIZ2WJ2pafZjUaj0lce52Ja2/zYdG2OOavjmHfCZv+KauoMruLTB7Pk1GFq1FN74TCLo8iFuiDqDyuXnxOR1qfrXebFs1ncbHGxMctfTaZkK7cNMnEyOsN/OmTCP62Po5CS0OMzE85KNUk7ELHCeUoEwjUDkP3ViBQ/gROMfhtikxD2K5RL3cSXkKg9d1cWwz/jNktRKnly9N9tHTNo/pOutOHwZcbeGFVDB9WpwhUuJE0wkWQdoayu+4GZ9HSdARq9kSgbApqvQ3YHH4KceckK0VLvY60lSfaySeqR332j0hYorRcAbVQdoGO51ZGsb0mhSKfyBZnSNmu2d3o3wRpJl/bIXit8+EvfxBHxR5UR2Yg5tTCFMXZOax8gNwK3w1xeVErJQbV60bmh06dNdw3lcV4Nw2/fy+M/ccdBMwzu2jVz5OmmPQI6I2antmKcKsinQYY/h/AV3YvDsnNqI6+wg9s1o6BpmVHX4YhbyaONkPRWom5sorop5ypT18d19xgwi4TmLYsjKP1zYEiE/Etg3QSSHCPoR8T3lJ2SLrhywxcCqv8AeyVa7A9Nt0NSx7h5/tm4Wkg0mcFbQBtvqdrIt3ZfHGnUg233+9DQ7HE42+HUXOqNdDsfjNISugaTpDeYqfQO7sFiT94JTdz92CXvRw7on+mCnSWY75mQDODWQQ3+dtGgky/Oymlajuz/kQKTy2LojYkEbRyAM0wqWsHDR5N7FSuuUU3uiFQejf00gnYllqIr6LzqXaD8cHMGELkmvgalUbx7a5RjAa3qof3tscx/YMoQnGJohxA1YxJOpaPqatnJ0052yYP4W8i2FDMCASq47NwJPER+VlAoN5WnNNUJqNdqlM7UeXp7dGF/kxmhzHrLICO4QJf4u+ipVtieGO9Ki0Fw1OeSoRo4/SIyhINXYJ6QlV05C3dXWjrjqU+Q03ig7xAs6s1mHLfSSzHG9GFyuE6EIDKZPMoQyhmJg1qbkhM/92P8iI1Ojdhy4r5n0ax4NO4O57BHkl1BpJDUnYa7IUVHhT7tQ3pelagkQ/LirWqywKiAjFZSwp4kX/vztqMEe8v8bfgI5/HWGNNavhmpTlq+bNMPcutH9QGrg9BDlc71TgLl0WfRfHO9iT8dCS9HZonCLSUW/Wh53rJVyxXsTlbDKwo1M+9v4t3eOXexFI2+Fplo6YOpkkSnpx+K/6mu0UZY13Dn3qQWlaFw8hc0cFDbV3U3cQlPUwVhtqrvRGnZnXqrLKjpk4hlynn8WQ4t18IbV5X708e/zq51s3/XlGYJ06mDyk8pIrS8pL4YhUzcLU1BrUpgS9ZNhWoU5eWFmGDt4uqgNq/kpzW4ge9dcUkOY8YdyPDr2yRPL9Q7359pXFF1Y74HHfLIlzatYQq6BBuBmFG426WDrc4vpDPOoZ7rsLKsIMN3Gt1IGCJb38pZwuRtFcUmujRwbffK8RczpVouRXfx9GfrjR+FinzDufqIm0c/zjZxOzyVlFmTmwe1jvLcFeJhQGWiVqWhba7ZJVuzk5U3wZauqfpwdigFSfQZzIH0c3PDdzsArmESWB+f/NWBLUeGcDNj05k5s7GXvXsZ4bTWD69Hl2A7c5y/LrEj2EEHHXc7HFW4stULeVMVfcU+9FZ197MRJnTiadlXajU/ahfK31/gO9e+LUypGQILQudZrVPVsMZp5wdWYCt9ru4r8RHDRuoc2SGNG1LhMpibsCdxT70MfTVbJqq/Ky9g7mT6jy2SO+9ZpA1BYV6JTXcwAFtt5xPczY3OQzeSgOzo3OxzXkfDxLwENNEvSNzVo4iw9FGZqpixrLJtMgQy7uRVr6NzV+f7ZHnPnUcX+TpvXKw7xF08QynhsOs1kOZ4fO7joe3w23HrOgcbJMr8UBHFtSWhTo6jdPkhMzVJhcRItDzLB1TSwIK6CoCHdeUp2d7mLyXH95IKswc6J+S7GdOhE8rpX5TTBwxOK6TiZzx2GDiSvF+JTIb1faHeIhON9TyUcOOG3aiNPkpAg0wPI0Nmni4Y4Hdy9Bfp+PckA+oawn1j4d8pV4mBmtsm8Tf9zY6B75niCBmRF/F6uRHrhaV6VUK1tyoK5qdFIZpDS/vyQW3oi/zxR9PRrE+Fkc5q+ghrFAu83nR3/SojKdStgKblG2UnGcDNv0vJYkq/hqvjiFr7MOVm+2N2Jr8HPucvdRSPeLcHbte2wJyI/keFEV4LPAQKjACa6IJnMeioLehH6ZZF3PgBfywOlsTfldg3RKftypMrlTlXkg2Dqtz6swjTg2OOEdw3DlBbYYycViDnxGiE2vlYq0YVVo/VOhd1dHSeso/1P/CKNVuGZed8zsGm3Vp9bOII1e51ZbAYE7TlzwtY0Yzsj5EaiRY9BznCnez70b22cixdmQ2jM7pCvsswf5HgAEAKpvwNqgFxJAAAAAASUVORK5CYII="/>                                     <span>请点击右上角按钮，分享到朋友圈</span>                                    <img class="tip-arrow" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB0AAAAeCAYAAADQBxWhAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NTc3MiwgMjAxNC8wMS8xMy0xOTo0NDowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjg4MjU3Mjk2OUFFRjExRTRCQ0Q1RUFGNTNDM0ZFREZFIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjg4MjU3Mjk3OUFFRjExRTRCQ0Q1RUFGNTNDM0ZFREZFIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6ODgyNTcyOTQ5QUVGMTFFNEJDRDVFQUY1M0MzRkVERkUiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6ODgyNTcyOTU5QUVGMTFFNEJDRDVFQUY1M0MzRkVERkUiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz596RQpAAABEklEQVR42uyVOwrCQBRFM9HGKo2FVoJWVuICtLdyD7oFcQ0ibkEtLRRRXEEW4AYEsfFT2AT8oKh53sCAhcRMJpPY5MJp8ubNYSbhhRGRpihNYIOh50pHqoAyuIILKHmtVyE0wJo+WfFnoUkZmNF3prwWirRN7mmFIa2C5w/pA1RUSrPgQN7Zg4wKaQKYJB6T9wSSdsl/OkGkdWBLSG3e61taABbJx+J7aLrgiEuBMTACjEmD75FigrO3DxqKZvSAKRj4bhswtwZd+0NiaSyNpZFKczJNSZCXFKZBz6V29pKuQ7jBzT/e6eJX0Rn4pFh4AkWwi+qkL/4L3EV1vVtQAxORr1c2N3AESzAHI3AXaXwLMAA48uFVor591AAAAABJRU5ErkJggg=="/>                                </div>                                <div  class="shadow"></div>                            </div>',u=!1,a=e(o);s.append(a),a.hide(),a.on("click",function(e){u&&(a.hide(),u=!1)}),i.on("click",function(e){e.preventDefault(),a.show(),u=!0})}else{if(SOHUZ.isPreviewMode())return;if(r.indexOf("Win")>-1||r.indexOf("Mac")>-1||r.indexOf("Linux")>-1){var f="",l=location.href.split("/"),c=l.length;c>6?f="http://"+l[2]+"/"+l[c-3]+"/"+l[c-2]+"/"+l[c-1]:f="http://"+l[2],i.on("click",function(t){f===""&&(f="www.kuaizhan.com");var n='<div class="mod-weixin-pc">                                        <div class="header"><h3>分享到微信朋友圈</h3></div>                                        <p><img src="http://www.kuaizhan.com/common/encode-png?large=true&data='+f+' "/></p>                                        <div class="footer">用微信"扫一扫"二维码即可分享给您的朋友或朋友圈。</div>                                    </div>',r='<div class="backdorp"></div>',i=e(n),o=e(r);window.location.href.indexOf("embed=true")>-1&&i.addClass("mobile"),s.append(i),s.append(o),o.on("click",function(e){i.hide(),o.hide()})})}else{var o='<div class="mod-shareweixin">                                    <div class="tip">                                        <span>该浏览器暂不支持直接分享到微信朋友圈</span>                                    </div>                                    <div class="shadow"></div>                                </div>',u=!1,a=e(o);a.hide(),s.append(a),a.on("click",function(e){u&&(a.hide(),u=!1)}),i.on("click",function(e){e.preventDefault(),a.show(),u=!0})}}}}}),define("componentsPath/system_plugin/latest_version/components/focus/portal",["zepto"],function(e){function t(t,n){function x(){u=s.children,s.style.width=a*(u.length+4)+"px";var t={"50%":"0.5","56.2%":"0.562","75%":"0.75"};l.toString().indexOf("%")>-1&&l in t&&(l=parseFloat(t[l])),e(s).css("padding-bottom",0),n.theme!="theme2"&&(s.style.height=Math.round(a*l*100)/100+"px",e(s).parents(".focus-w").css("height",Math.round(a*l*100)/100)),n.theme=="theme2"&&(s.style.height=a*l+35+"px"),e.each(u,function(t){u[t].style.width=a+"px",e(u[t]).addClass("swipe-item")}),r.transitions&&o<2?(s.style.width=a+"px",n.continuous=!1):(s.appendChild(u[0].cloneNode(!0)),s.appendChild(u[1].cloneNode(!0)),s.insertBefore(u[o-1].cloneNode(!0),s.children[0]),s.insertBefore(u[o-1].cloneNode(!0),s.children[0])),O(0),s.style.display="block",e.each(e(s).parents(".focus-w").find(".focus-ctr").find("span"),function(t,n){e(this).tap(function(e){f=t+2,O(.25)})})}function T(e,t,n){var t=(t||0)*-1;e.style.transition=e.style.webkitTransition=e.style.MozTransition=e.style.OTransition=n+"s",e.style.transform="translate3d("+t+"px, 0, 0)",e.style.webkitTransform="translate3d("+t+"px, 0, 0)",e.style.msTransform=e.style.MozTransform=e.style.OTransform="translate3d("+t+"px, 0, 0)"}function N(){s.addEventListener("touchstart",C,!1),s.addEventListener("touchmove",k,!1),s.addEventListener("touchend",L,!1),s.addEventListener("touchcancel",L,!1)}function C(e){r.android&&e.stopPropagation();if(p){var t=e.touches[0];m=t.pageX,g=t.pageY,p=!1,B()}return o<2&&(p=!0),!1}function k(e){var t=e.changedTouches[0],n=t.pageX,r=t.pageY;y={x:n-m,y:r-g},p||(B(),Math.abs(y.x)>20&&Math.abs(y.y)<10&&Math.abs(_(y.y/y.x))<30&&(e.preventDefault(),y.x<-b?(p=!0,d=!0,E=1,f++,O(.25)):y.x>b&&(p=!0,d=!0,f--,E=-1,O(.25))))}function L(e){var t=e.changedTouches[0],n=t.pageX,i=t.pageY;return y={x:n-m,y:i-g},r.android&&e.stopPropagation(),p||Math.abs(y.x)>=Math.abs(y.y)&&(y.x<-b?(p=!0,d=!0,f++,O(.25)):y.x>b&&(p=!0,d=!0,f--,O(.25))),H(),d=!1,!1}function A(e){return!1}function O(){var t=t||0;n.continuous&&!v&&!d&&(f+=E,E<0&&(E=1)),f>=o+2&&E>0?(M(f-1-o),e(u[f-1-o]).addClass("cur bound"),T(s,h+a*(f-1-(o+1)),0),f=2):f<=1&&E<0&&(M(f+1+o),e(u[f+1+o]).addClass("cur bound"),T(s,h+a*(f-1+(o+1)),0),f=o+1);if(v)o==1?(n.theme!="theme2"&&(f=2),T(s,h-a*(f-1),t),f=0):T(s,h+a*(f-1),t),M(f),e(u[f]).addClass("cur").siblings().removeClass("cur bound");else var r=setTimeout(function(){T(s,h+a*(f-1),.5),M(f),e(u[f]).addClass("cur").siblings().removeClass("cur bound"),clearTimeout(r)},20);n.transitionEnd&&n.transitionEnd(f-2,u[f-2]),v=!1}function M(t){if(n.theme=="theme2")for(i=0;i<u.length;i++)i!=t?(e(u[i]).css("height",""),e(u[i]).addClass("item-height")):(e(u[i]).css("height",a*l+35),e(u[i]).addClass("item-height"))}function _(e){return Math.atan(e)*180/Math.PI}var r={addEventListener:!!window.addEventListener,touch:"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,android:navigator.userAgent.indexOf("Android")>-1||navigator.userAgent.indexOf("Adr")>-1,weixin:navigator.userAgent.toLowerCase().match(/MicroMessenger/i)=="micromessenger",transitions:function(e){var t=["transitionProperty","WebkitTransition","MozTransition","OTransition","msTransition"];for(var n in t)if(e.style[t[n]]!==undefined)return!0;return!1}(document.createElement("swipe"))};if(!t)return;var s=t.children[0],o=n.length||0,u,a,n=n||{},f=parseInt(n.startSlide,10)||2,l=n.ratio||.75,c=parseFloat(e(t).css("width"))-parseFloat(e(t).css("margin-left"))*2,a=n.theme=="theme2"?c*(.7-(l==1.5?.2:0)):c,h=c*(n.theme=="theme2"?.55-(l==1.5?.3:0):1),p=!0,d=!1,v=!0,m=0,g=0,y={x:0,y:0},b=Number(n.minRange),w=n.speed||.25,E=1;try{navigator.control.gesture(!1)}catch(S){}x(),N();var D,P=2e3,H=function(){var e=P;clearInterval(D),D=setInterval(O,e)},B=function(){clearInterval(D)};n.continuous&&H()}return{onAfterRender:function(n){var r=e(n).data("auto").toString()=="false"?!1:!0,i=e(n).data("theme"),s=e(n).data("ratio"),o=e(n).find(".focus-ctr span").length,u=e(n);u.find("span").get(0).className="cur",new t(u.find(".swipe")[0],{speed:.25,startSlide:2,theme:i,ratio:s,continuous:r,minRange:10,length:o,transitionEnd:function(t,n){o==2?t>=2?e(n).parents(".focus-w").find(".focus-ctr").find("span").removeClass("cur").eq(t-2).addClass("cur"):e(n).parents(".focus-w").find(".focus-ctr").find("span").removeClass("cur").eq(t).addClass("cur"):e(n).parents(".focus-w").find(".focus-ctr").find("span").removeClass("cur").eq(t).addClass("cur")}})}}}),define("componentsPath/system_plugin/latest_version/components/layout2coloums/portal",["zepto",""],function(e){return{onAfterRender:function(e){}}}),define("componentsPath/system_plugin/latest_version/components/qrcode/portal",[],function(){}),define("componentsPath/system_plugin/latest_version/components/video/portal",["zepto"],function(e){var t,n={youku:{getPlayerHtmlMobile:function(e,t){return'<iframe class="video" src="'+t.url+'" frameborder=0 allowfullscreen allowtransparency="true" wmode="transparent">iframe</iframe>'}},tudou:{getPlayerHtmlMobile:function(e,t){return'<iframe class="video" src="'+t.url+'" allowfullscreen=1 allowtransparency="true" scrolling="no" border="0" frameborder="0" allowtransparency="true" wmode="transparent"></iframe>'}},tencent:{getPlayerHtmlMobile:function(e,t){return'<iframe class="video" src="'+t.url+'" allowfullscreen=1 allowtransparency="true" scrolling="no" border="0" frameborder="0" allowtransparency="true" wmode="transparent"></iframe>'}},sohu:{getPlayerHtmlMobile:function(e,t){return'<iframe class="video" src="'+t.url+'" allowfullscreen=1 allowtransparency="true" scrolling="no" border="0" frameborder="0" allowtransparency="true" wmode="transparent"></iframe>'}}};return{onAfterRender:function(t){var r=e(t),i=r.parent().width(),s=r.data("type"),o=r.data("url"),u=r.find("iframe");if(u.length==0){r.append(n[s].getPlayerHtmlMobile(i,{url:o}));var a=r.find("iframe.video"),f=a.width()/4*3;a.attr("data-height",f),a.height(a.data("height")),r.find(".video-play-icon").height(a.height()).width(a.width())}r.addClass("video-play")}}}),define("componentsPath/system_plugin/latest_version/components/mobile_button/portal",[""],function(){return{onAfterRender:function(e){}}}),define("componentsPath/system_plugin/latest_version/components/weibo/portal",[""],function(){return{onAfterRender:function(e){}}}),define("componentsPath/system_plugin/latest_version/components/title/portal",["zepto"],function(e){return{onAfterRender:function(e){}}}),define("componentsPath/system_plugin/latest_version/components/nav/portal",["zepto"],function(e){return{onAfterRender:function(t){var n=window.location.pathname,r=window.location.origin,i=!1;e(t).find("li a").each(function(){if(i)return;e(this).attr("href").toLowerCase().replace(r,"")==n&&(e(this).parent().addClass("cur"),i=!0)})}}}),define("componentsPath/system_plugin/latest_version/components/divider/portal",[""],function(){return{onAfterRender:function(e){}}}),define("componentsPath/system_plugin/latest_version/components/forumlist/portal",["zepto"],function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},n=function(n){return String(n).replace(/[&<>"'\/]/g,function(e){return t[e]})},r='<div class="item js-item"><input type="hidden" name="forum_id"><div class="forum-avatar"><img src="http://kzcdn.itc.cn/res/skin/images/empty.gif" width="50" height="50"></div><div class="forum-content"><div class="table-wrapper"><div class="table-cell-wrapper"><div class="forum-header"><span class="forum-title"></span><span class="today-count js-today-count"></span></div><div class="forum-footer"></div></div></div></div></div>',i='<li class="js-item"><input type="hidden" name="forum_id"><div class="forum-avatar"><img src="{{avatar}}" width="50" height="50"></div><div class="forum-title"><span>{{title}}</span></div></li>',s='<div class="more-forums-list"><a type="button" class="js-add-more-list add-more-list" href="javascript:;">点击加载更多</a></div>',o='<div class="more-forums-grid"><a type="button" class="js-add-more-grid add-more-grid" href="javascript:;"></a></div>',u='<div class="empty-forum-list"><div class="default-img"></div><div class="default-word"><span class="empty-word">暂无社区</span></div></div>',a=function(n){n.site_id&&parseInt(n.limit)!==0?n.forum_ids?e.ajax({url:"/club/apiv1/sites/"+n.site_id+"/forum-list?",type:"get",dataType:"json",data:{forum_ids:n.forum_ids},success:function(e){n.callback(e)}}):e.ajax({url:"/club/apiv1/sites/"+n.site_id+"/forums?state=50&offset="+n.offset+"&limit="+n.limit,type:"get",dataType:"json",success:function(e){n.callback(e)}}):n.callback([])},f=function(n){e.ajax({url:"/club/apiv1/sites/"+n.site_id+"/forums-count?state=50",type:"get",dataType:"json",success:function(e){n.callback(e)}})},l=function(i){a({site_id:i.site_id,offset:i.offset,limit:i.limit,forum_ids:i.forum_ids,callback:function(t){var o=e("<div></div>");if(t.length>0)for(var a in t){var f=e(r);f.find("input[name='forum_id']").val(t[a]._id),f.find(".forum-avatar img").attr("src",t[a].avatar),f.find(".forum-header .forum-title").html(n(t[a].title)),f.find(".forum-header .js-today-count").html("话题 "+t[a].counts.topics),t[a].current_user?t[a].is_joined=t[a].current_user.is_subscriber:t[a].is_joined=!1,t[a].is_joined&&t[a].desc!==""?f.find(".forum-footer").html('<div class="forum-desc"><span class="already-join"></span><span class="desc">'+n(t[a].desc)+"</span></div>"):!t[a].is_joined&&t[a].desc!==""?f.find(".forum-footer").html('<div class="forum-desc"><span class="desc">'+n(t[a].desc)+"</span></div>"):t[a].is_joined&&t[a].desc===""?f.find(".forum-footer").html('<div class="forum-desc"><span class="already-join"></span></div>'):f.find(".forum-footer").remove(),parseInt(a)===t.length-1&&f.addClass("last"),o.append(f)}var l=i.wrap.find(".js-item").length;t.length+l>0?(t.length+l<parseInt(i.show_count)&&o.append(s),i.wrap.find(".more-forums-list")[0]!=undefined?i.wrap.find(".more-forums-list").replaceWith(o.html()):i.wrap.append(o.html())):i.wrap.html(u)}})},c=function(r){a({site_id:r.site_id,offset:r.offset,limit:r.limit,forum_ids:r.forum_ids,callback:function(t){var s=e('<ul class="forum-list-ul"></ul>');if(t.length>0)for(var a in t){var f=e(i);f.find("input[name='forum_id']").val(t[a]._id),f.find(".forum-avatar img").attr("src",t[a].avatar),f.find(".forum-title span").html(n(t[a].title)),s.append(f)}var l=r.wrap.find(".js-item").length;t.length+l>0?r.wrap.find(".more-forums-grid")[0]!=undefined?(r.wrap.find("ul").append(s.html()),t.length+l>=parseInt(r.show_count)&&r.wrap.find(".more-forums-grid").remove()):(r.wrap.append(s),t.length+l<parseInt(r.show_count)&&r.wrap.append(o)):r.wrap.html(u)}})};return{onAfterRender:function(t){var n=e(t),r=SOHUZ.page.site_id,i=n.data("n_forums"),s=n.data("theme2"),o=n.data("filter_choose"),u=n.data("show_count"),a=n.data("show_item_keys"),h=n.data("left_item_keys"),p=a.split(";");p.splice(p.length-1,1);var d=h.split(";");d.splice(d.length-1,1);var v=0,m={};o?(v=p.length,m={site_id:r,offset:0,limit:v,wrap:n,show_count:u,forum_ids:p}):(f({site_id:SOHUZ.page.site_id,callback:function(e){u=parseInt(e)}}),v=i,s&&(v=i*4),m={site_id:r,offset:0,limit:v,show_count:u,wrap:n}),s?c(m):l(m),n.on("click",".js-item",function(t){t.preventDefault();var n=e(this),i=n.find("input[name='forum_id']").val();n.css("opacity",.8),kaq&&(kaq("create",r),kaq("send","event","system_plugin","click","forumlist",1)),window.location.href="/club/apiv1/forums/"+i+"/jump-to"}),n.on("click",".js-add-more-list",function(){var e=n.find(".js-item").length,t=5,i={site_id:r,offset:e,limit:t,show_count:u,wrap:n};o&&(i.limit=u-e,i.forum_ids=d),kaq&&(kaq("create",r),kaq("send","event","system_plugin","click","forumlist",1)),l(i)}),n.on("click",".js-add-more-grid",function(){var e=n.find(".js-item").length,t=5,i={site_id:r,offset:e,limit:t,show_count:u,wrap:n};o&&(i.limit=u-e,i.forum_ids=d),kaq&&(kaq("create",r),kaq("send","event","system_plugin","click","forumlist",1)),c(i)})}}}),define("componentsPath/system_plugin/latest_version/components/map/portal",["zepto"],function($){return{onAfterRender:function(el){var data=$(el).data("map"),data=eval("("+data+")"),lng=data.lng,lat=data.lat,zoom=data.zoom,maptype=data.maptype;console.log("onAfterRender"),console.log(data);if(maptype=="gaode"){console.log(lng),console.log(lat);var mapSrc="http://restapi.amap.com/v3/staticmap?markers=mid,0xFF0000,A:"+lng+","+lat+"&key=1cc43613e9ba921318906bac8ed34119&size=480*360&zoom="+zoom,maphref="http://m.amap.com/navi/?dest="+lng+","+lat+"&key=d1792d19abe5e3f3cc9152c8c2f1553f",viewD=$('<a href="'+maphref+'"><img src="'+mapSrc+'" style="max-width:320px;width:100%;height:auto;display:block;margin-left:auto;margin-right:auto;"></a>');$(el).append(viewD),console.log("append gaode")}else{var viewD=$('<a href="http://api.map.baidu.com/geocoder?location='+lat+","+lng+'&coord_type=bd09ll&output=html&src=sohu|kuaizhan target=_blank" ><img src="                         http://api.map.baidu.com/staticimage?width=480&height=360&center='+lng+","+lat+"&zoom="+zoom+"&markers="+lng+","+lat+'&markerStyles=-1,http://7bede40ef4e00.cdn.sohucs.com/defc4f288e402d0777f28adaeac3c6f1,-1"                         style="max-width:320px;width:100%;height:auto;display:block;margin-left:auto;margin-right:auto;" </a>                         ');$(el).append(viewD),console.log("append baidu")}}}}),define("componentsPath/system_plugin/latest_version/components/pictxt/portal",[],function(){}),define("componentsPath/system_plugin/latest_version/components/picgroup/portal",["zepto"],function(e){return{onAfterRender:function(t,n){function l(){s.on("touchstart",function(t){if(t.touches.length==1)r.touch_start=e.extend({},t.touches[0]),t.preventDefault(),t.stopPropagation(),r.startTime=(new Date).getTime(),r.image_top=parseInt(s.find("img").position().top);else if(t.touches.length==2){var n=t.touches[0].pageX,i=t.touches[1].pageX,o=t.touches[0].pageY,u=t.touches[1].pageY;r.startSize=(n-i)*(o-u)}}),s.on("touchmove",function(e){e.stopPropagation(),e.preventDefault();if(e.touches.length==1){r.touch_end=e.touches[0];var t=r.image_top+(r.touch_end.clientY-r.touch_start.clientY),n=s.find("img").height()*r.scale-s.height();n=n<0?0:n,n>-t&&t<0?r.trans_y=t:t>0?r.trans_y=0:n<=-t&&(r.trans_y=-n),g(!1)}else e.touches.length==2&&(r.istouch=!0)}),s.on("touchend",function(e){e.stopPropagation(),e.preventDefault();if(!r.touch_end&&!r.istouch){setTimeout(function(){v()},300);return}var t=r.image_top+1.5*(r.touch_end.clientY-r.touch_start.clientY),n=s.find("img").height()*r.scale-s.height();n=n<0?0:n,n>-t&&t<0?r.trans_y=t:t>0?r.trans_y=0:n<=-t&&(r.trans_y=-n),g(!0);var i=r.touch_end;r.touch_start&&r.touch_end&&(r.touch_start.clientX-i.clientX>40?c():r.touch_start.clientX-i.clientX<-40?h():Math.abs(r.touch_start.clientX-i.clientX)<10&&Math.abs(r.touch_start.clientY-i.clientY)<10&&setTimeout(function(){v()},300)),r.touch_end=null,r.touch_start=null,r.istouch=!1})}function c(){r.index<e(t).find("[data-origin]").length-1&&(r.index++,m())}function h(){r.index>0&&(r.index--,m())}function p(){n.location.hash="#showImage",e(t).find(".image-viewer").show(),e("body").addClass("no-scroll"),m(),f=function(){r.displayImage()},e(n).resize(f)}function d(){f&&e(n).unbind("resize",f),s.find("img").removeAttr("style"),e("body").removeClass("no-scroll"),o.html(""),u.html(""),s.unbind("touchstart"),s.unbind("touchend"),s.unbind("touchmove"),e(t).find(".image-viewer").hide()}function v(){n.location.hash=="#showImage"?n.history.back():n.location.hash=""}function m(){var e=r.all[r.index];if(!e)return;u.html("<span> "+(r.index+1)+" / "+r.all.length+"</span>"),y();var t=new Image;t.onload=function(){var i=t.width,s=t.height,u=n.innerWidth,a=n.innerHeight,f=i/u,l=f<1?i:u,c=f<1?s:s/f,h=c>a?0:(a-c)/2,p=l>u?0:(u-l)/2;o.html("<img src='"+e+"'>").find("img").css({width:l,height:c,"margin-top":h+"px","margin-left":p+"px"}),r.trans_x=0,r.trans_y=0,r.scale=1},t.onerror=function(){o.html("<span>图片加载失败</span>")},t.src=e}function g(e){s.find("img").css({transform:"translate("+r.trans_x+"px,"+r.trans_y+"px) scale("+r.scale+")","-webkit-transform":"translate("+r.trans_x+"px,"+r.trans_y+"px) scale("+r.scale+")",transition:e?"transform 600ms cubic-bezier(0.1, 0.57, 0.1, 1)":" none","-webkit-transition":e?"-webkit-transform 600ms cubic-bezier(0.1, 0.57, 0.1, 1)":" none"})}function y(){var e=50,t=50,i=n.innerWidth,s=n.innerHeight,u=e/i,a=u<1?e:i,f=u<1?t:t/u,l=f>s?0:(s-f)/2,c=a>i?0:(i-a)/2;o.html("<img src='http://club.xiaobai.kuaizhan.com/images/b927cad6.loading_black.gif'>").find("img").css({width:a,height:f,"margin-top":l+"px","margin-left":c+"px"}),r.trans_x=0,r.trans_y=0,r.scale=1}var r=this;e(t).parents().find(".picview").remove();var i=e(t).find("ul").find("li"),s=i.length>0?e(t).append("<div class='image-viewer'><div class='view'></div><div class='paging'></div></div>"):e("#picview"),o=e(t).find(".view"),u=e(t).find(".paging"),a,f=null;e(t).delegate("[data-role='pic-list']","click",function(n){if(e(n.target).closest("[data-origin]").find("a").attr("href")!="javascript:;")return;a=e(n.target).closest("[data-origin]").data("origin").split("/imageView")[0];if(n.target.tagName!=="IMG")return;r.all={},r.index=0;var i=e(t).find("[data-origin]");r.all.length=i.length,i.each(function(t,n){var i=e(n).data("origin").split("/imageView")[0];a==i&&(r.index=t),r.all[t]=i}),p(),l()}),e(n).on("hashchange",function(){n.location.hash==""&&d()}),e(t).find(".image-viewer").click(function(e){setTimeout(function(){v()},300)})}}}),define("componentsPath/system_plugin/latest_version/components/shopslist/portal",["zepto"],function(e){return{onAfterRender:function(t){function c(){navigator.geolocation?navigator.geolocation.getCurrentPosition(p,h,{timeout:5e3}):console.log("show Error")}function h(e){console.log(e)}function p(e){user_lat=e.coords.latitude,u=e.coords.longitude,i.find(".auto-select").append('<li data-type="2"><a href="javascript:;">距离排序</a></li>')}var n=this,r='<a class="item" href="">                        <div class="topwrp">                            <div class="img"></div>                            <div class="shopinfo">                                <div class="title">none</div>                                <div class="detail">                                    <span style="margin-right: 10px;" data-role="sales_volume">销量333</span>                                </div>                                <div class="distance"></div>                            </div>                            <div class="einfo">                                <div class="baoyou">                                    <div class="icon"></div>                                    <div class="text">满54包邮</div>                                </div>                                <div class="manjian">                                    <div class="icon"></div>                                    <div class="text">满23减4，满19减2</div>                                </div>                            </div>                        </div>                    </a>',i=e(t),s=i.data("show_count"),o=0,u=null,a=i.find('[data-role="mask"]'),f=i.data("items");if(f)var l=f.length;c();var d=function(t,n){var r={limit:s+1,offset:t,attach_settings:!0,is_online:!0};u&&user_lat&&(r.geo_lng=u,r.geo_lat=user_lat),o==1?r.sort_by_volume=!0:o==2?r.sort_by_distance=!0:o==3?r.filters=["delivery_free"]:o==4?r.filters=["full_to_off"]:o==5?r.filters=["full_to_off","delivery_free"]:r.sort_by_weight=!0,e.ajax({url:"/shop/api/sites/"+SOHUZ.page.site_id+"/shops",type:"get",data:r,success:function(e){e.length===r.limit?(e.pop(),n(e,!0)):n(e,!1)}})},v=function(){d(0,function(e,t){i.find(".itemlist").html(""),i.find(".loadmore").remove(),i.find(".noitem").remove();if(e.length==0)return i.find(".content").append('<div class="noitem">没有找到合适的店铺哦</div>'),!1;y(e),t&&i.find(".content").append('<div class="loadmore">显示更多</div>')})},m=function(e){var t=f.slice(e,e+s);y(t),i.find(".loadmore")[0]?l<=e+s&&i.find(".loadmore").remove():l>e+s&&i.find(".content").append('<div class="loadmore">显示更多</div>')},g=function(){var e=i.find(".item").length;d(e,function(e,t){y(e),t||i.find(".loadmore").remove()})},y=function(t){for(var n in t){var s=e(r);s.find(".title").html(t[n].title),s.find('[data-role="sales_volume"]').html("销量"+t[n].sales_volume),s.attr("href","/shop/shops/"+t[n]._id),t[n].avatar?s.find(".img").html('<img src="'+t[n].avatar+'">'):s.find(".img").html('<img src="http://www.kuaizhan.com/shop-office/images/static/default_shop.png">'),t[n].full_to_off?t[n].full_to_off==1?s.find(".manjian .text").html(b(t[n].settings.full_to_off_list)):s.find(".manjian .text").html(t[n].full_to_off):s.find(".manjian").hide(),t[n].delivery_free?t[n].delivery_free==1?s.find(".baoyou .text").html("满"+t[n].settings.delivery_free_condition+"包邮"):s.find(".baoyou .text").html(t[n].delivery_free):s.find(".baoyou").hide(),!t[n].full_to_off&&!t[n].delivery_free&&s.find(".einfo").hide();if(t[n].distance_to_me){var o=t[n].distance_to_me;o>5e3?o="":o>1?o=parseInt(o)+" km":o>.001?o=parseInt(o*1e3)+" m":o="附近",s.find(".distance").html(o)}i.find(".itemlist").append(s)}},b=function(e){var t=[];for(var n=0;n<e.length;n++)t.push("满"+e[n].price+"减"+e[n].off_price);return t.join("，")};if(i.data("filter_choose")){var w=[];e.each(f,function(e,t){w.push(t._id)}),e.ajax({url:"/shop/api/sites/"+SOHUZ.page.site_id+"/shops",type:"get",data:{fetch_by_ids:!0,shop_ids:w},success:function(e){for(var t in e)f[t].sales_volume=e[t].sales_volume;i.find(".itemlist").html(""),m(0)}})}else v();i.on("click",'[data-role="auto"]',function(){return e(this).hasClass("cur")?(i.find(".select-nav .cur").removeClass("cur"),i.find(".auto-select").hide(),a.hide()):(i.find(".select-nav .cur").removeClass("cur"),e(this).addClass("cur"),i.find(".type-select").hide(),i.find(".auto-select").show(),a.show()),!1}).on("click",'[data-role="type"]',function(){return e(this).hasClass("cur")?(i.find(".select-nav .cur").removeClass("cur"),i.find(".type-select").hide(),a.hide()):(i.find(".select-nav .cur").removeClass("cur"),e(this).addClass("cur"),i.find(".auto-select").hide(),i.find(".type-select").show(),a.show()),!1}).on("click",".type-item",function(){return e(this).hasClass("hover")?e(this).removeClass("hover"):e(this).addClass("hover"),!1}).on("click",".auto-select li",function(){return i.find(".auto-select li.hover").removeClass("hover"),e(this).addClass("hover"),i.find('[data-role="auto"] span').html(e(this).html()),i.find(".select-nav .cur").removeClass("cur"),i.find(".auto-select").hide(),a.hide(),o=e(this).data("type"),v(),!1}).on("click",".btn-confirm",function(){return i.find(".select-nav .cur").removeClass("cur"),i.find(".type-select").hide(),a.hide(),i.find(".type-item.hover").length===2?o=5:i.find(".type-item.hover").length===1?o=i.find(".type-item.hover").data("type"):o=0,v(),!1}).on("click",".btn-reset",function(){return i.find(".type-item").removeClass("hover"),!1}).on("click",".loadmore",function(){if(i.data("filter_choose")){var e=i.find(".item").length;m(e)}else g();return!1}).on("click",".item",function(){kaq&&(kaq("create",SOHUZ.page.site_id),kaq("send","event","system_plugin","click","shopslist","1"))})}}}),define("componentsPath/system_plugin/latest_version/components/link/portal",[""],function(){return{onAfterRender:function(e){}}}),define("resource-common",["zepto","lib/mustache"],function(e,t){var n='<div class="ui-alert" data-role="search-loading">正在努力搜索...</div>',r='<div class="module-empty" data-role="empty"><div class="module-empty-notice">没有找到相关内容</div></div>',i='<div class="ui-alert" data-role="search-loading">浏览器开启了隐私模式，禁用后可使用浏览历史功能</div>',s='<div class="search-result-nav" data-role="search-result-nav">            <ul>                <li data-role="all">                    <a href="#" data-role="all" title="全部">全部</a><i></i>                </li>                <li data-role="commodity">                <a href="#" data-role="commodity" title="电商">电商</a><i></i>                </li>                <li data-role="forum-topic">                    <a href="#" data-role="forum-topic" title="社区">社区</a><i></i>                </li>                <li data-role="content">                    <a href="#" data-role="content" title="文章">文章</a><i></i>                </li>            </ul>            </div>',o='<div class="search-result-wrap{{#nav}} no-nav{{/nav}}" data-role="search-result-wrap">                <div class="search-result-inner" data-role="search-result-inner">                    <div data-role="commodity-placeholder"></div>                    <div data-role="forum-placeholder"></div>                    <div data-role="content-placeholder"></div>                </div>            </div>',u={search_gettext:function(t,n){return e.isEmptyObject(n)?null:(e.each(n,function(e,n){if(n==null||n==undefined)n="";t=t.replace(new RegExp("("+e+")","g"),n)}),t)},clear_dom:function(t,n,r){e.each(n,function(n,r){n=="search-inner"?e.each(r,function(e,n){t.find(n).remove()}):n=="search-outer"&&e.each(r,function(t,n){e("body").find(n).css("display","none")})}),r&&t.find("[data-role='search-notice']").removeClass("mui-screen hide")},load_nav:function(n,r){var i=Number(r.ec)+Number(r.content)+Number(r.forum),u=s;if(r.scope=="partical"&&i>=2)r.ec||(u=this.search_gettext(u,{'data-role="commodity"':"data-role=\"commodity\" style='display:none;'"})),r.content||(u=this.search_gettext(u,{'data-role="content"':"data-role=\"content\" style='display:none;'"})),r.forum||(u=this.search_gettext(u,{'data-role="forum-topic"':"data-role=\"forum-topic\" style='display:none;'"}));else if(r.scope=="partical")return u="",n.after(t.to_html(o,{nav:!0})),!0;e(u).insertAfter(n).after(t.to_html(o,{nav:!1}))},load_result:function(e,t,n,r){var i=r.find("[data-role='search-result-inner']");e.scrollTop(0),i.append(t),r.find("[data-role='search-result-nav'] li").removeClass("cur")},empty_result:function(t,n,i){var s=!1,o=!n.shopnum&&!n.commoditynum&&!n.forumnum&&!n.topicnum&&!n.contentnum&&!n.categorynum,u=Number(t.ec)+Number(t.content)+Number(t.forum);(t.scope=="all"||t.scope=="partical"&&u==3)&&n.shops==1&&n.commodity==1&&n.forum==1&&n.topic==1&&n.content==1&&n.category==1&&o&&(s=!0),t.scope=="partical"&&u==1?(t.ec||t.content||t.forum)&&o&&(s=!0):t.scope=="partical"&&(!t.ec||!t.forum||!t.content)&&o&&(s=!0),s?e(r).appendTo(i.find("[data-role='search-result-wrap']")):i.find("[data-role='empty']").remove()},highlight_keyword:function(e,t){var n="",r=new RegExp("("+t+")","gi");return e=this.search_gettext(e,{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"}),n=e.replace(r,'<span class="kz-f-c-t">$1</span>'),n},show_search_loading:function(){return n},show_browser_private_mode:function(){return i},show_module_empty:function(){return r}};return u}),define("ec",["zepto","lib/mustache","resource-common"],function(e,t,n){var r='<div data-role="shop-commodity" style="clear:both;">{{shop_commodity}}</div>',i='<div class="category-wrap">                    <div class="shop-list-title kz-f-c-t"><span>店铺</span>                    <span class="shop-more"><a href="#" data-role="{{module_name}}" data-keyword="{{keyword}}">{{more_word}}</a></span></div>                    <div class="shop-list" data-role="shop-list">{{shop}}</div>',s='{{#shop}}<div class="shop-item">                    <div class="shop-avatar">                        <img src="{{avatar}}" width="50" height="50">                    </div>                    <a href="{{link}}">                    <div class="shop-commodity">                        <div class="{{#last}}table-wrapper last{{/last}}{{^last}}table-wrapper{{/last}}">                            <div class="table-cell-wrapper">                                <div class="shop-header">                                    <span class="shop-title">{{name}}</span>                                </div>                                <div class="shop-footer">                                    <div class="shop-desc">                                        <span class="desc">销量: {{sales}}</span>                                    </div>                                </div>                            </div>                        </div>                    </div>                    </a>                </div>{{/shop}}',o='<div class="shop-item last">                                <span class="load-more"><a data-role="load-more-shop">展开更多结果                                <span class="font-ico icon-btn-downarrow"></span></a>                                </span>                                </div>',u='<div class="shop-item last">                                    <span class="load-more"><a data-role="load-collapse-shop">收起更多结果                                    <span class="font-ico icon-btn-uparrow"></span></a>                                    </span>                                    </div>',a='<div class="commodity-title kz-f-c-t" data-role="commodity-title"><span>商品</span>                                <span class="commodity-more"><a href="javascript:;" data-role="{{module_name}}" data-keyword="{{keyword}}">{{more_word}}</a></span></div>                                <div class="commodity-list" data-role="commodity-list"><ul>{{commodity}}</ul></div>',f='{{#commodity}}<li class="item">                    <a href="/api-bridge/shop/commodity/{{id}}/jump-to">                        <div class="img">                            <img src="{{avatar}}">                        </div>                        <div class="info">                            <div class="title"><span>{{title}}</span></div>                            <div class="price-wrp">                                <div class="price"><span>¥{{price}}</span></div>                                <div class="original-price"><span>{{original_price}}</span></div>                            </div>                        </div>                    </a>                </li>{{/commodity}}',l=0,c=0,h=function(t){e.ajax({url:"/api-bridge/shop/api/sites/"+t.site_id+"/shops?query="+t.keyword,type:"get",dataType:"json",beforeSend:function(t){l=setTimeout(function(t){e("body").append(n.show_search_loading()),c=0},200)},success:function(n){c&&clearTimeout(c),e("body").find("[data-role='search-loading']").remove(),t.loadstatus&&(t.loadstatus.shops=!0,t.loadstatus.shopnum=n.length),t.callback(n,t.keyword,t.limit,t.loadstatus)}})},p=function(t){e.ajax({url:"/api-bridge/shop/api/sites/"+t.site_id+"/commodities?query="+t.keyword+"&is_online=1",type:"get",dataType:"json",beforeSend:function(t){l=setTimeout(function(t){e("body").append(n.show_search_loading()),l=0},200)},success:function(n){l&&clearTimeout(l),e("body").find("[data-role='search-loading']").remove(),t.loadstatus&&(t.loadstatus.commodity=!0,t.loadstatus.commoditynum=n.length),t.callback(n,t.keyword,t.limit,t.loadstatus)}})},d={get_shop_commodity_list:function(l){h({site_id:l.site_id,keyword:l.keyword,loadstatus:l.loadstatus,limit:l.limit,callback:function(c,h,d,v){var m="",g="",y={},b=[],w="",E=0,S=!1;y.shop=b,E=c.length;if(l.is_all)e.each(c,function(e,t){if(e>2)return S=!0,!1;b.push({avatar:t.avatar?t.avatar:SOHUZ.CONF.url_res+"/res/post/images/default-icon.png",link:"/shop/shops/"+t._id,sales:t.sales_volume,name:n.highlight_keyword(t.title,h)})}),m=t.to_html(s,y);else if(d==3&&E>d){var x=!1;e.each(c,function(e,t){if(e>=d)return!1;e==d-1&&(x=!0),b.push({avatar:t.avatar?t.avatar:SOHUZ.CONF.url_res+"/res/post/images/default-icon.png",link:"/shop/shops/"+t._id,sales:t.sales_volume,name:n.highlight_keyword(t.title,h),last:x})}),m=t.to_html(s,y)+o}else{var x=!1;e.each(c,function(e,t){e==E-1&&(x=!0),b.push({avatar:t.avatar?t.avatar:SOHUZ.CONF.url_res+"/res/post/images/default-icon.png",link:"/shop/shops/"+t._id,sales:t.sales_volume,name:n.highlight_keyword(t.title,h),last:x})}),m=t.to_html(s,y),E>3&&(m+=u)}m?g=t.to_html(i,{module_name:"ec-more",keyword:l.keyword,more_word:S?"更多店铺结果 &gt;":"",shop:m}):g="",p({site_id:l.site_id,keyword:l.keyword,loadstatus:l.loadstatus,callback:function(i,s,o){var u,c="",h={},p=[],d=!1;h.commodity=p,e.each(i,function(e,t){if(e>3&&l.is_all)return d=!0,!1;p.push({title:n.highlight_keyword(t.title,s),id:t._id,avatar:t.avatar,original_price:t.original_price?"¥"+t.original_price:"",price:t.price})}),u=t.to_html(f,h),u?c=t.to_html(a,{module_name:"ec-more",keyword:l.keyword,more_word:d?"更多商品结果 &gt;":"",commodity:u}):c="",g+=c,!m&&!u&&(g=n.show_module_empty()),w=t.to_html(r,{shop_commodity:g}),l.is_all?(l.screen.find("[data-role='commodity-placeholder']").html(w),n.empty_result(l.scope,l.loadstatus,l.screen)):(l.screen.find("[data-role='search-notice']").addClass("mui-screen hide"),n.clear_dom(l.screen,{"search-inner":["[data-role='search-result-nav']","[data-role='search-result-wrap']","[data-role='forum-topic']","[data-role='category-post']","[data-role='shop-commodity']","[data-role='empty']"],"search-outer":["[data-role='search-loading']","[data-role='front-search-component']"]},!1),n.load_nav(l.pop_form,l.scope),n.load_result(l.pop_form,w,l.scope,l.screen),l.screen.find("li[data-role=commodity]").addClass("cur"))}})}})}};return d}),define("forum",["zepto","lib/mustache","resource-common"],function(e,t,n){var r='<div data-role="forum-topic" style="clear:both;">{{forum_topic}}</div>',i='<div class="forum-wrap">                    <div class="forum-list-title kz-f-c-t"><span>社区</span>                    <span class="forum-more"><a href="#" data-role="{{module_name}}" data-keyword="{{keyword}}">{{more_word}}</a></span></div>                    <div class="forum-list" data-role="forum-list">{{forum}}</div>',s='{{#forum}}<div class="forum-item">                    <div class="forum-avatar">                        <img src="{{avatar}}" width="50" height="50">                    </div>                    <a href="/api-bridge/apiv1/forums/{{id}}/jump-to">                    <div class="forum-content">                        <div class="{{#last}}table-wrapper last{{/last}}{{^last}}table-wrapper{{/last}}">                            <div class="table-cell-wrapper">                                <div class="forum-header">                                    <span class="forum-title">{{title}}</span>                                </div>                                <div class="forum-footer">                                    <div class="forum-desc">                                        <span class="desc">话题: {{topics}}</span>                                    </div>                                </div>                            </div>                        </div>                    </div>                    </a>                </div>{{/forum}}',o='<div class="topic-wrap">                    <div class="topic-list-title kz-f-c-t"><span>帖子</span>                    <span class="topic-more"><a href="#" data-role="{{module_name}}" data-keyword="{{keyword}}">{{more_word}}</a></span></div>                    <div class="topic-list" data-role="topic-list">{{topics}}</div>',u='{{#topic}}<div class="topic-item">                    <a href="/api-bridge/apiv1/topics/{{id}}/jump-to">                    <div class="topic-avatar">                        <img src="{{avatar}}" width="50" height="50">                    </div>                    <div class="topic-author">                        <div class="table-wrapper">                            <div class="table-cell-wrapper">                                <div class="topic-header">                                    <span class="topic-title">{{nick}}</span>                                </div>                                <div class="topic-footer">                                    <div class="topic-desc">                                        <span class="desc">{{last_login_time}} {{default_address_id}}</span>                                    </div>                                </div>                            </div>                        </div>                    </div>                    <div class="topic-content">                        <span>{{content}}</span>                    </div>                    <div class="topic-like">                        <span class="ki-t i-like"></span><span class="like">{{like}}</span>                        <span class="ki-t i-comment"></span><span class="comment">{{replies}}</span>                    </div>                    </a>                </div>{{/topic}}',a='<div class="forum-item last">                                <span class="load-more"><a data-role="load-more">展开更多结果                                <span class="font-ico icon-btn-downarrow"></span></a>                                </span>                                </div>',f='<div class="forum-item last">                                    <span class="load-more"><a data-role="load-collapse">收起更多结果                                    <span class="font-ico icon-btn-uparrow"></span></a>                                    </span>                                    </div>',l=0,c=0,h=function(t){e.ajax({url:"/api-bridge/apiv1/sites/"+t.site_id+"/forums?query="+t.keyword,type:"get",dataType:"json",beforeSend:function(t){l=setTimeout(function(t){e("body").append(n.show_search_loading()),l=0},200)},success:function(n){l&&clearTimeout(l),e("body").find("[data-role='search-loading']").remove(),t.loadstatus&&(t.loadstatus.forum=!0,t.loadstatus.forumnum=n.length),t.callback(n,t.keyword,t.limit,t.loadstatus)}})},p=function(t){e.ajax({url:"/api-bridge/apiv1/sites/"+t.site_id+"/topics?query="+t.keyword,type:"get",dataType:"json",beforeSend:function(t){c=setTimeout(function(t){e("body").append(n.show_search_loading()),c=0},200)},success:function(n){c&&clearTimeout(c),e("body").find("[data-role='search-loading']").remove(),t.loadstatus&&(t.loadstatus.topic=!0,t.loadstatus.topicnum=n.length),t.callback(n,t.keyword,t.loadstatus)}})},d={get_forum_topic_list:function(l){h({site_id:l.site_id,keyword:l.keyword,limit:l.limit,loadstatus:l.loadstatus,callback:function(c,h,d,v){var m="",g="",y={},b=[],w="",E="",S="",x={},T=[],N=0,C=!1;y.forum=b,N=c.length;if(l.is_all)e.each(c,function(e,t){if(e>2)return C=!0,!1;b.push({avatar:t.avatar,id:t._id,topics:t.counts.topics,title:n.highlight_keyword(t.title,h)})}),m=t.to_html(s,y);else if(d==3&&N>d){var k=!1;e.each(c,function(e,t){if(e>=d)return!1;e==d-1&&(k=!0),b.push({avatar:t.avatar,id:t._id,topics:t.counts.topics,title:n.highlight_keyword(t.title,h),last:k})}),m=t.to_html(s,y)+a}else{var k=!1;e.each(c,function(e,t){e==N-1&&(k=!0),b.push({avatar:t.avatar,id:t._id,topics:t.counts.topics,title:n.highlight_keyword(t.title,h),last:k})}),m=t.to_html(s,y),N>3&&(m+=f)}m?g=t.to_html(i,{module_name:"forum-topic-more",keyword:l.keyword,more_word:C?"更多社区结果 &gt;":"",forum:m}):g="",p({site_id:l.site_id,keyword:l.keyword,loadstatus:l.loadstatus,callback:function(i,s,a){var f=!1;x.topic=T,e.each(i,function(e,t){if(l.is_all&&e>2)return f=!0,!1;T.push({avatar:t.user.avatar.mid?t.user.avatar.mid:"http://club.m.kuaizhan.com/images/face/default-avatar.png",nick:t.user.nick,id:t._id,last_login_time:t.user.last_login_time,default_address_id:t.user.default_address_id,content:n.highlight_keyword(t.brief,s),like:t.counts.upvotes?t.counts.upvotes:0,replies:t.counts.replies?t.counts.replies:0})}),E=t.to_html(u,x),E?S=t.to_html(o,{module_name:"forum-topic-more",keyword:l.keyword,more_word:f?"更多帖子结果 &gt;":"",topics:E}):S="",g+=S,!m&&!E&&(g=n.show_module_empty()),w=t.to_html(r,{forum_topic:g}),l.is_all?(l.screen.find("[data-role='forum-placeholder']").html(w),n.empty_result(l.scope,l.loadstatus,l.screen)):(l.screen.find("[data-role='search-notice']").addClass("mui-screen hide"),n.clear_dom(l.screen,{"search-inner":["[data-role='search-result-nav']","[data-role='search-result-wrap']","[data-role='forum-topic']","[data-role='category-post']","[data-role='shop-commodity']","[data-role='empty']"],"search-outer":["[data-role='search-loading']","[data-role='front-search-component']"]},!1),n.load_nav(l.pop_form,l.scope),n.load_result(l.pop_form,w,l.scope,l.screen),l.screen.find("li[data-role=forum-topic]").addClass("cur"))}})}})}};return d}),define("content",["zepto","lib/mustache","resource-common"],function(e,t,n){var r='<div data-role="category-post" style="clear:both;">{{category_post}}</div>',i='<div class="category-wrap">                    <div class="category-list-title kz-f-c-t"><span>栏目</span>                    <span class="category-more"><a href="#" data-role="{{module_name}}" data-keyword="{{keyword}}">{{more_word}}</a></span></div>                    <div class="category-list" data-role="category-list">{{category}}</div>',s='{{#category}}<div class="category-item">                    <div class="category-avatar">                        <img src="{{avatar}}" width="50" height="50">                    </div>                    <a href="{{link}}">                    <div class="category-post">                        <div class="{{#last}}table-wrapper last{{/last}}{{^last}}table-wrapper{{/last}}">                            <div class="table-cell-wrapper">                                <div class="category-header">                                    <span class="category-title">{{title}}</span>                                </div>                                <div class="category-footer">                                    <div class="category-desc">                                        <span class="desc">文章数: {{topics}}</span>                                    </div>                                </div>                            </div>                        </div>                    </div>                    </a>                </div>{{/category}}',o='<div class="category-item last">                                <span class="load-more"><a data-role="load-more-cate">展开更多结果                                <span class="font-ico icon-btn-downarrow"></span></a>                                </span>                                </div>',u='<div class="category-item last">                                    <span class="load-more"><a data-role="load-collapse-cate">收起更多结果                                    <span class="font-ico icon-btn-uparrow"></span></a>                                    </span>                                    </div>',a='<div class="content-title kz-f-c-t" data-role="content-title">                                <span>文章</span>                                <span class="content-more">                                    <a href="#" data-role="{{module_name}}" data-page="{{page}}" data-keyword="{{keyword}}">{{more_word}}</a>                                </span>                            </div>                            <div class="content-list" data-role="content-list"><ul>{{content}}</ul></div>',f='{{#pic_content}}<li>                <a href="{{link}}">                    <h3>{{title}}</h3>                    <div class="pic">                        <img src="{{image}}">                    </div>                    <p class="content-desc">{{content}}</p>                    <p class="content-other">                        <span class="font-ico icon-preview"></span><span class="">{{n_read}}</span>                        <span class="time">{{time}}</span>                    </p>                </a>                </li>{{/pic_content}}',l='{{#nopic_content}}<li>                <a href="{{link}}">                    <h3 style="margin-left: 0px;">{{title}}</h3>                    <p class="content-desc">{{content}}</p>                    <p class="content-other">                        <span class="font-ico icon-preview"></span><span class="">{{n_read}}</span>                        <span class="time">{{time}}</span>                    </p>                </a>                </li>{{/nopic_content}}',c='<span class="content-page">                                <a data-role="content" data-page="{{page}}" data-keyword="{{keyword}}">点击加载更多                                    <span class="font-ico icon-btn-downarrow"></span>                                </a>                            </span>',h=0,p=0,d=function(t){e.ajax({url:"/api-bridge/search/ajax-search-post-category?site_id="+t.site_id+"&q="+t.keyword+"&per_page=20&page="+t.page,type:"get",dataType:"json",beforeSend:function(t){h=setTimeout(function(t){e("body").append(n.show_search_loading()),h=0},200)},success:function(n){h&&clearTimeout(h),e("body").find("[data-role='search-loading']").remove(),t.loadstatus&&(t.loadstatus.category=!0,t.loadstatus.categorynum=n.data.total_num),t.callback(n.data.list,t.keyword,t.limit,t.loadstatus,t.page)},error:function(){h&&clearTimeout(h),e("body").find("[data-role='search-loading']").remove(),t.loadstatus&&(t.loadstatus.category=!0,t.loadstatus.categorynum=0),t.callback({},t.keyword,t.limit,t.loadstatus,t.page)}})},v=function(t){e.ajax({url:"/api-bridge/search/ajax-search-post?site_id="+t.site_id+"&q="+t.keyword+"&per_page=20&page="+t.page,type:"get",dataType:"json",beforeSend:function(t){p=setTimeout(function(t){e("body").append(n.show_search_loading()),p=0},200)},success:function(n){p&&clearTimeout(p),e("body").find("[data-role='search-loading']").remove(),t.loadstatus&&(t.loadstatus.content=!0,t.loadstatus.contentnum=n.data.total_num),t.callback(n,t.keyword,t.limit,t.loadstatus,t.page)}})},m={get_category_post_list:function(h){d({site_id:h.site_id,keyword:h.keyword,limit:h.limit,loadstatus:h.loadstatus,page:h.page,callback:function(p,d,m,g){var y="",b="",w={},E=[],S="",x=0,T=!1;w.category=E,x=p.length;if(h.is_all)e.each(p,function(e,t){if(e>2)return T=!0,!1;E.push({avatar:t.cover?t.cover:SOHUZ.CONF.url_res+"/res/post/images/default-icon.png",link:t.link,topics:t.n_posts,title:n.highlight_keyword(t.name,d)})}),y=t.to_html(s,w);else if(m==3&&x>m){var N=!1;e.each(p,function(e,t){if(e>=m)return!1;e==m-1&&(N=!0),E.push({avatar:t.cover?t.cover:SOHUZ.CONF.url_res+"/res/post/images/default-icon.png",link:t.link,topics:t.n_posts,title:n.highlight_keyword(t.name,d),last:N})}),y=t.to_html(s,w)+o}else{var N=!1;e.each(p,function(e,t){e==x-1&&(N=!0),E.push({avatar:t.cover?t.cover:SOHUZ.CONF.url_res+"/res/post/images/default-icon.png",link:t.link,topics:t.n_posts,title:n.highlight_keyword(t.name,d),last:N})}),y=t.to_html(s,w),x>3&&(y+=u)}y?b=t.to_html(i,{module_name:"content-more",keyword:h.keyword,more_word:T?"更多栏目结果 &gt;":"",category:y}):b="",v({site_id:h.site_id,keyword:h.keyword,loadstatus:h.loadstatus,page:h.page,callback:function(i,s,o,u,p){var d="",v="",m=[],g=[],w={},E=!1;w.pic_content=g,w.nopic_content=m,i.ret==0&&(s=s.toLowerCase(),e.each(i.data.list,function(e,t){if(e>2&&h.is_all)return E=!0,!1;t.title.toLowerCase().indexOf(s.toLowerCase())!=-1&&(t.title=n.highlight_keyword(t.title,s)),t.brief.toLowerCase().indexOf(s.toLowerCase())!=-1?t.brief=n.highlight_keyword(t.brief,s):t.brief=n.highlight_keyword(t.content,s),t.image?g.push({link:t.link,title:t.title,image:t.image,content:t.brief,time:t.time,n_read:t.n_read}):m.push({link:t.link,title:t.title,content:t.brief,time:t.time,n_read:t.n_read})}),v+=t.to_html(f,w),v+=t.to_html(l,w));if(!v)d="";else{d=t.to_html(a,{module_name:"content-more",keyword:h.keyword,more_word:E?"更多文章结果 &gt;":"",content:v}),!h.is_all&&p==1&&i.data.has_more&&(d+=t.to_html(c,{page:p+1,keyword:s}));if(!h.is_all&&p!=1){i.data.has_more?h.screen.find("a[data-role='content']").attr("data-page",p+1):h.screen.find("a[data-role='content']").parent("span").addClass("nocontent").html("没有更多内容"),h.screen.find("div[data-role='content-list'] ul").append(v);return}}b+=d,!y&&!v&&(b=n.show_module_empty()),S=t.to_html(r,{category_post:b}),h.is_all?(h.screen.find("[data-role='content-placeholder']").html(S),n.empty_result(h.scope,h.loadstatus,h.screen)):(h.screen.find("[data-role='search-notice']").addClass("mui-screen hide"),n.clear_dom(h.screen,{"search-inner":["[data-role='search-result-nav']","[data-role='search-result-wrap']","[data-role='forum-topic']","[data-role='category-post']","[data-role='shop-commodity']","[data-role='empty']"],"search-outer":["[data-role='search-loading']","[data-role='front-search-component']"]},!1),n.load_nav(h.pop_form,h.scope),n.load_result(h.pop_form,S,h.scope,h.screen),h.screen.find("li[data-role=content]").addClass("cur"))}})}})}};return m}),define("all",["zepto","ec","forum","content","resource-common"],function(e,t,n,r,i){var s={get_all:function(e){var s=Number(e.scope.ec)+Number(e.scope.content)+Number(e.scope.forum),o=!1;i.clear_dom(e.screen,{"search-inner":["[data-role='search-result-nav']","[data-role='search-result-wrap']"]},!1),i.load_nav(e.pop_form,e.scope),e.screen.find("input[name='search-pop-keyword']").blur(),e.screen.find("[data-role='search-notice']").addClass("mui-screen hide");if(e.scope.content||e.scope.scope=="all")e.scope.content&&s==1&&(o=!0),r.get_category_post_list({site_id:SOHUZ.page.site_id,keyword:e.keyword,screen:e.screen,pop_form:e.pop_form,scope:e.scope,is_all:o?!1:e.is_all,loadstatus:e.loadstatus,limit:3,page:1});if(e.scope.forum||e.scope.scope=="all")e.scope.forum&&s==1&&(o=!0),n.get_forum_topic_list({site_id:SOHUZ.page.site_id,keyword:e.keyword,screen:e.screen,pop_form:e.pop_form,scope:e.scope,is_all:o?!1:e.is_all,loadstatus:e.loadstatus,limit:3});if(e.scope.ec||e.scope.scope=="all")e.scope.ec&&s==1&&(o=!0),t.get_shop_commodity_list({site_id:SOHUZ.page.site_id,keyword:e.keyword,screen:e.screen,pop_form:e.pop_form,scope:e.scope,is_all:o?!1:e.is_all,loadstatus:e.loadstatus,limit:3});e.screen.find("li[data-role=all]").addClass("cur")}};return s}),define("componentsPath/system_plugin/latest_version/components/search/portal",["zepto","lib/mustache","ec","forum","content","all","resource-common"],function(e,t,n,r,i,s,o){return{onAfterRender:function(u){function E(t){var n,r=location.hash.split(/[?,&]/);n=decodeURIComponent(r[1]).split("=")[1],r[0]=="#search-middle"?(e("body").find("[data-role='search-result-wrap']").length!=0&&(e("body").find("[data-role='search-result-nav']").css("display","none"),e("body").find("[data-role='search-result-wrap']").css("display","none"),e("body").find("[data-role='search-notice']").length==0?S.init(e("body").find("[data-role='mod-search-pop']"),a,f):e("body").find("[data-role='search-notice']").removeClass("mui-screen hide")),S.open(a,f),o.clear_dom(e("body"),{"search-inner":["[data-role='search-result-nav']","[data-role='forum-topic']","[data-role='category-post']","[data-role='shop-commodity']","[data-role='empty']"],"search-outer":["[data-role='search-loading']","[data-role='front-search-component']"]},!0),e("body").find("input[name='search-pop-keyword']").val(""),e("body").find("input[name='search-pop-keyword']").attr("placeholder",f),e("body").find("input[name='search-pop-keyword']").focus()):r[0]==""?(S.hide(e("body").find("[data-role='mod-search-pop']")),e("body").find("[data-role='front-search-component']").css("display","")):r[0]=="#search-result"&&(S.open(a,n),s.get_all({site_id:SOHUZ.page.site_id,keyword:n,screen:e("body").find("[data-role='mod-search-pop']"),pop_form:e("body").find("div[data-role=search-pop-form]"),scope:m,is_all:!0,loadstatus:w}),e("body").find("input[name='search-pop-keyword']").val(n),e("body").find("input[name='search-pop-keyword']").blur())}var a=e(u).data("tags"),f=e(u).data("keywords"),l='<div class="mod-search-pop mui-screen hide" data-role="mod-search-pop">                    <div class="form-wrap kz-f-c-t kz-b-c-t" data-role="search-pop-form">                        <a href="javascript:;" class="search-leftarrow" data-role="page-back"><span class="ki-t i-back"></span></a>                        <div class="search-form kz-b-c-t">                            <form name="search-pop-form" action="return false;">                            <input name="search-pop-keyword" type="text" placeholder="{{keywords}}"/>                            </form>                            <a href="javascript:;" class="search-del" data-role="search-del"><span class="ki-t i-delete"></span></a>                        </div>                        <a class="search-btn" data-role="search-btn" href="javascript:;">搜索</a>                    </div>                </div>',c='<div class="search-notice" data-role="search-notice">{{search_hottags}}{{search_history}}</div>',h='<div class="search-title kz-f-c-t"><span>热门搜索</span></div>                <div class="search-hot" data-role="search-hot">{{hottags}}</div>',p='{{#search}}<a class="search-tag" id="{{hottag_id}}" data-role="search-tag" href="javascript:;">{{hottag_text}}</a>{{/search}}',d='<div class="search-title kz-f-c-t"><span>搜索历史</span></div>                <div class="search-history">{{search_history_items}}</div>',v='{{#history}}<div class="history-items" data-role="s_h_id_{{id}}">                        <span class="font-ico icon-btn-time"></span>                        <span class="items" style="display:inline-block;" id="{{item_data}}" data-role="history-item"><a >{{item_data}}</a></span>                        <a href="javascript:;" class="history-del" data-role="history-del" data-id="{{id}}">                        <span class="font-ico icon-close"></span>                        </a>                    </div>{{/history}}',m={scope:e(u).data("scope"),ec:e(u).data("ec"),forum:e(u).data("forum"),content:e(u).data("content")},g=location.href,y=g.substr(g.lastIndexOf("/")+1).split(/[?,&]/),b={};y.forEach(function(e,t){var n=e.split("=");b[n[0]]=n[1]}),b.tab&&(m={},e.inArray(b.tab,["ec","forum","content"])>=0?(m.scope="partical",m[b.tab]=!0):m={scope:"all",ec:!0,forum:!0,content:!0});var w={content:!1,forum:!1,topic:!1,ec:!1,contentnum:0,forumnum:0,topicnum:0,ecnum:0};/iPhone\sOS.*QQ[^B]/.test(navigator.userAgent)?window.onpopstate=E:window.onhashchange=E,e(".mod-search").on("click",function(e){window.location.hash="search-middle"});var S={init:function(u,f,l){var g=[],y={},b=[],E=[],S={},x=[],T=0,N;y.search=b,S.history=x;if(f.trim().length!=0){a=o.search_gettext(a,{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"}),g=a.split(",");for(var C=0,T=g.length;C<T;C++)b.push({hottag_id:g[C],hottag_text:g[C]});c=t.to_html(c,{search_hottags:t.to_html(h,{hottags:t.to_html(p,y)}),search_history:"{{search_history}}"})}else c=t.to_html(c,{search_hottags:"",search_history:"{{search_history}}"});"localStorage"in window&&window.localStorage!==null&&(E=JSON.parse(localStorage.getItem("search_history")),E&&E.length!=0?(E.reverse(),T=E.length,e.each(E,function(e,t){x.push({id:T-e-1,item_data:t.replace(/&/g,"&amp").replace(/\"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")})}),c=t.to_html(c,{search_history:t.to_html(d,{search_history_items:t.to_html(v,S)})})):c=t.to_html(c,{search_history:""})),N=u.find("div[data-role=search-pop-form]"),N.after(c),N.find(".search-history").on("touchstart",function(e){e.preventDefault()}),u.on("tap","a[data-role='search-del']",function(t){t.preventDefault();var n=e(this),r=u.find("input[name='search-pop-keyword']");n.css("display","none"),r.val("")}).on("input","input[name='search-pop-keyword']",function(t){t.preventDefault();var n=e(this),r=u.find("a[data-role='search-del']");n.val().trim().length!=0?r.css("display","block"):r.css("display","none")}).on("keydown","input[name='search-pop-keyword']",function(t){var n=e(this),r=u.find("a[data-role='search-del']");n.val().trim().length!=0?r.css("display","block"):r.css("display","none")}).on("keypress","input[name='search-pop-keyword']",function(t){var n=e(this),r=u.find("a[data-role='search-del']");n.val().trim().length!=0?r.css("display","block"):r.css("display","none")}).on("tap","input[name='search-pop-keyword']",function(t){t.preventDefault();var n=e(this),r=n.val(),i=u.find("a[data-role='search-del']");i.css("display","none")}).on("tap","a[data-role='history-del']",function(t){t.preventDefault();var n=e(this),r=n.data("id"),i=[];n.parents("div[data-role=s_h_id_"+r+"]").remove(),i=JSON.parse(localStorage.getItem("search_history")),i.splice(r,1),localStorage.setItem("search_history",JSON.stringify(i))}).on("submit","form[name=search-pop-form]",function(t){var n=e(this),r=n.find("input[name='search-pop-keyword']"),i=[],s=0,u="";if(r.val().trim().length==0)return!1;if(!JSON.parse(localStorage.getItem("search_history")))i.push(r.val());else{i=JSON.parse(localStorage.getItem("search_history")),s=i.length;for(var a in i)i[a]==r.val().trim()&&i.splice(a,1);r.val().trim().length!=0&&i.push(r.val())}try{localStorage.setItem("search_history",JSON.stringify(i))}catch(f){Storage.prototype._setItem=Storage.prototype.setItem,Storage.prototype.setItem=function(){};var l=0;l=setTimeout(function(e){o.show_browser_private_mode(),l=0},200),l&&clearTimeout(l)}return window.location.hash="search-result?keyword="+encodeURIComponent(r.val()),!1}).on("touchend click","a[data-role=search-btn]",function(e){var t=u.find("input[name='search-pop-keyword']"),n=[],r=0;if(t.val().trim().length==0)return!1;if(!JSON.parse(localStorage.getItem("search_history")))n.push(t.val());else{n=JSON.parse(localStorage.getItem("search_history")),r=n.length;for(var i in n)n[i]==t.val().trim()&&n.splice(i,1);t.val().trim().length!=0&&n.push(t.val())}return localStorage.setItem("search_history",JSON.stringify(n)),window.location.hash="search-result?keyword="+encodeURIComponent(t.val()),e.preventDefault(),!1}).on("touchend click","a[data-role='all']",function(e){var t=u.find("input[name='search-pop-keyword']");s.get_all({site_id:SOHUZ.page.site_id,keyword:t.val(),screen:u,pop_form:N,scope:m,is_all:!0,loadstatus:w}),e.preventDefault()}).on("touchend click","a[data-role='commodity']",function(e){var t=u.find("input[name='search-pop-keyword']");n.get_shop_commodity_list({site_id:SOHUZ.page.site_id,keyword:t.val(),screen:u,pop_form:N,scope:m,limit:3}),e.preventDefault()}).on("touchend click","a[data-role='forum-topic']",function(e){var t=u.find("input[name='search-pop-keyword']");r.get_forum_topic_list({site_id:SOHUZ.page.site_id,keyword:t.val(),screen:u,pop_form:N,scope:m,limit:3}),e.preventDefault()}).on("touchend click","a[data-role='content']",function(t){var n=e(this),r=u.find("input[name='search-pop-keyword']"),s=n.data("page");i.get_category_post_list({site_id:SOHUZ.page.site_id,keyword:r.val(),screen:u,pop_form:N,scope:m,limit:3,page:s?s:1}),t.preventDefault()}).on("touchend click","a[data-role='search-tag']",function(t){var n=e(this),r=n.attr("id"),i=u.find("input[name='search-pop-keyword']");i.val(r),u.find("a[data-role='search-del']").css("display","block"),window.location.hash="search-result?keyword="+encodeURIComponent(r),t.preventDefault()}).on("touchend click","span[data-role='history-item']",function(t){var n=e(this),r=n.attr("id"),i=u.find("input[name='search-pop-keyword']");i.val(r),u.find("a[data-role='search-del']").css("display","block"),window.location.hash="search-result?keyword="+encodeURIComponent(r),t.preventDefault()}).on("touchend click","a[data-role='forum-topic-more']",function(t){var n=e(this),i=n.data("keyword");r.get_forum_topic_list({site_id:SOHUZ.page.site_id,keyword:i,screen:u,pop_form:N,scope:m,limit:3}),t.preventDefault()}).on("touchend click","a[data-role='content-more']",function(t){var n=e(this),r=n.data("keyword"),s=n.data("page");i.get_category_post_list({site_id:SOHUZ.page.site_id,keyword:r,screen:u,pop_form:N,scope:m,limit:3,page:s?s:1}),t.preventDefault()}).on("touchend click","a[data-role='ec-more']",function(t){var r=e(this),i=r.data("keyword");n.get_shop_commodity_list({site_id:SOHUZ.page.site_id,keyword:i,screen:u,pop_form:N,scope:m,limit:3}),t.preventDefault()}).on("touchend click","a[data-role='load-more']",function(e){var t=u.find("input[name='search-pop-keyword']");r.get_forum_topic_list({site_id:SOHUZ.page.site_id,keyword:t.val(),limit:0,screen:u,pop_form:N,scope:m}),e.preventDefault()}).on("touchend click","a[data-role='load-collapse']",function(e){var t=u.find("input[name='search-pop-keyword']");r.get_forum_topic_list({site_id:SOHUZ.page.site_id,keyword:t.val(),limit:3,screen:u,pop_form:N,scope:m}),e.preventDefault()}).on("touchend click","a[data-role='load-more-cate']",function(e){var t=u.find("input[name='search-pop-keyword']");i.get_category_post_list({site_id:SOHUZ.page.site_id,keyword:t.val(),screen:u,pop_form:N,scope:m,limit:0,page:1}),e.preventDefault()}).on("touchend click","a[data-role='load-collapse-cate']",function(e){var t=u.find("input[name='search-pop-keyword']");i.get_category_post_list({site_id:SOHUZ.page.site_id,keyword:t.val(),screen:u,pop_form:N,scope:m,limit:3,page:1}),e.preventDefault()}).on("touchend click","a[data-role='load-more-shop']",function(e){var t=u.find("input[name='search-pop-keyword']");n.get_shop_commodity_list({site_id:SOHUZ.page.site_id,keyword:t.val(),screen:u,pop_form:N,scope:m,limit:0}),e.preventDefault()}).on("touchend click","a[data-role='load-collapse-shop']",function(e){var t=u.find("input[name='search-pop-keyword']");n.get_shop_commodity_list({site_id:SOHUZ.page.site_id,keyword:t.val(),screen:u,pop_form:N,scope:m,limit:3}),e.preventDefault()}).on("touchend click","a[data-role='page-back']",function(t){u.find("[data-role='search-result-nav']").length!=0?(o.clear_dom(u,{"search-inner":["[data-role='search-result-nav']","[data-role='search-result-wrap']","[data-role='forum-topic']","[data-role='category-post']","[data-role='shop-commodity']","[data-role='empty']"],"search-outer":["[data-role='search-loading']","[data-role='front-search-component']"]},!0),window.location.hash="search-middle"):(u.removeClass("show"),u.addClass("hide"),e("body").find("[data-role='front-search-component']").css("display",""),e("body").find("input[name='search-pop-keyword']").blur(),window.location.hash=""),t.preventDefault()})},hide:function(e){window.Zepto(document).trigger("search:close"),e.addClass("hide")},show:function(t){t.removeClass("hide"),t.addClass("show");var n=t.find("div[data-role=search-pop-form]").height(),r=t.find(".search-title").height(),i=t.find(".search-hot").height(),s=e(window).height(),o=s-(n+r*2+i+2),u=t.find(".search-history");u.length!=0&&u.css({height:o+"px","overflow-y":"scroll"})},open:function(t,n){var r=e("div[data-role='mod-search-pop']");r.length===0&&(l=l.replace("{{keywords}}",n),r=e(l),r.css("scrollTop","0"),e("body").append(r),this.init(r,t,n)),this.show(r),window.Zepto(document).trigger("search:open")}};location.hash!=""&&E()}}}),define("componentsPath/system_plugin/latest_version/components/sms_button/portal",[""],function(){return{onAfterRender:function(e){}}}),define("componentsPath/system_plugin/latest_version/components/button/portal",function(){}),define("componentsPath/system_plugin/latest_version/components/space/portal",[""],function(){return{onAfterRender:function(e){}}}),define("componentsPath/system_plugin/latest_version/components/global-nav/portal",["zepto"],function(e){return{onAfterRender:function(t){function p(e,t,r){v({remove:r,add:t},[i,s,o,u,a]),(e.body_class||e.icon_class)&&n.addClass(e.body_class+" "+e.icon_class)}function d(t){v({remove:t},[i,s,o,u,a]);var r=n.attr("class");if(r){var f="";e.each(r.split(" "),function(e,t){t.indexOf("main")<0&&(f+=t+" ")}),n.removeClass().addClass(f)}}function v(t,n){e.each(n,function(n,r){e.each(t,function(e,t){e=="add"?r.addClass(t):r.removeClass(t)})})}function m(){var t=SOHUZ.CONF.url_res+"/res/passport/images/default_headimg.png",r=n.find("[data-role='user-section'] img"),i=n.find("[data-role='user-section'] a");e.ajax({url:"/club/apiv1/me",type:"get",dataType:"json",success:function(e){e.avatar.mid&&(t=e.avatar.mid),r.attr("src",t),i.attr("href","/auth/me?callback="+window.location.href)},error:function(){r.attr("src",t),i.attr("href","/auth/me?callback="+window.location.href)}})}var n=e("body"),r={body_class:e(t).data("body-class"),icon_class:e(t).data("icon-class"),nav_type:e(t).data("nav-type")},i=n.find("[data-role='nav-header']"),s=n.find("[data-role='nav-icon-more']"),o=n.find("[data-role='mod-nav-theme']"),u=n.find("[data-role='nav-screen-mask']"),a=o.find(".list-items li");m();var f=n.find(".logo img");f.attr("src")||f.attr("src",SOHUZ.CONF.url_res+"/res/skin/images/img/logo-default.png");var l=window.location.href,c,h=SOHUZ.page.site_url?SOHUZ.page.site_url.length:0;c=l.substring(h),e.each(a,function(t,n){e(n).find("a").attr("href")==c&&e(n).addClass("cur")});switch(r.nav_type){case"t1":n.addClass("t1");break;case"t2":n.addClass("t2");break;case"t3":n.addClass("t3");break;default:}n.on("touchend click","[data-role='nav-icon-more']",function(t){var n=e(this),i=n.attr("class");if(i.indexOf("expand")>0)return d("expand"),!1;p(r,"expand","collapse"),u.css("height",e(window).height()),t.preventDefault()}).on("touchstart click","#phone-main [data-role='nav-screen-mask']",function(t){var n=e(this),r=n.attr("class");return r.indexOf("t5")>0||r.indexOf("t6")>0?(t.preventDefault(),!1):(d("expand"),t.preventDefault(),!1)}).on("touchend click","[data-role='list-in-box']",function(t){var n=e(this),i=o.attr("class");i.indexOf("line")>0?(p(r,"box","line"),n.find("span").removeClass("i-add").addClass("i-close"),o.siblings(".page-w").addClass("t5-box")):i.indexOf("box")>0&&(p(r,"line","box"),n.find("span").removeClass("i-close").addClass("i-add"),o.siblings(".page-w").removeClass("t5-box")),t.preventDefault()}).on("touchend click","[data-role='cell-more']",function(t){var i=e(this),s=n.find("[data-role='kz-bottom-float-layer']").css("height");o.attr("class").indexOf("expand")>0?o.removeClass("expand"):(p(r,"expand","collapse"),n.find(".dropbox").css("bottom",parseInt(s)+"px")),t.preventDefault()})}}}),define("componentsPath/system_plugin/latest_version/components/layout_floor/portal",["zepto",""],function(e){return{onAfterRender:function(e){}}}),define("componentsPath/system_plugin/latest_version/components/topiclist/portal",["zepto","http://kzcdn.itc.cn/res/ui/js/lib/mustache.js"],function(e,t){var n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},r="http://pic.kuaizhan.com/g2/M01/86/67/CgpQVFcMscWAUxP9AAAFAQZSmLs2216697",i="http://pic.kuaizhan.com/g2/M00/86/67/CgpQVFcMscSAeD6wAAAGM7keIeg1403527",s="http://pic.kuaizhan.com/g2/M00/88/1D/wKjmqlcMscWAO-t-AAADaBpBY785185457",o="http://pic.kuaizhan.com/g2/M00/86/67/CgpQVFcMscaADWq1AAADXtkNlHM5243073",u="http://pic.kuaizhan.com/g1/M00/A7/03/wKjmqVdOlt2AUpTBAAACgZDb7QM2775940",a="http://pic.kuaizhan.com/g2/M00/A9/6F/wKjmqldOm4CAdyS3AAACmrX4ZPw7061668",f="http://pic.kuaizhan.com/g2/M01/A9/6F/wKjmqldOm4CAAoTnAAACM9FbKeM0870782",l="http://pic.kuaizhan.com/g2/M01/A7/BA/CgpQVFdOm4CAL_NmAAACWpzPJbQ5253100",c='{{#has_image_type_pic}}<img class="left-img {{#image_is_last_img}}last-img{{/image_is_last_img}}" src="{{image_type_pic}}"/>{{/has_image_type_pic}}                        {{#has_audio_type_pic}}<img class="left-img {{#audio_is_last_img}}last-img{{/audio_is_last_img}}" src="{{audio_type_pic}}"/>{{/has_audio_type_pic}}                        {{#has_video_type_pic}}<img class="left-img {{#video_is_last_img}}last-img{{/video_is_last_img}}" src="{{video_type_pic}}"/>{{/has_video_type_pic}}                        {{#has_media_type_pic}}<img class="left-img {{#media_is_last_img}}last-img{{/media_is_last_img}}" src="{{media_type_pic}}"/>{{/has_media_type_pic}}',h='{{#has_audio_type_pic}}<img class="left-img {{#audio_is_last_img}}last-img{{/audio_is_last_img}}" src="{{audio_type_pic}}"/>{{/has_audio_type_pic}}                        {{#has_media_type_pic}}<img class="left-img {{#media_is_last_img}}last-img{{/media_is_last_img}}" src="{{media_type_pic}}"/>{{/has_media_type_pic}}',p='{{#has_topic_content}}                             <div class="topic-content {{#has_forum_name}}topic-content-with-header{{/has_forum_name}}">                                 <div class="title">{{topic_title}}</div>                                 <div class="content">{{topic_content}}</div>                             </div>                         {{/has_topic_content}}',d='{{#open_reward}}                             <img class="icon-reward" src="http://pic.kuaizhan.com/g2/M00/6D/E4/CgpQVFbFliSAK_JaAAAI9bo4crI7844908"/>                             <span class="reward-count">{{tips}}</span>                         {{/open_reward}}                         <img class="icon-like" src="http://pic.kuaizhan.com/g2/M00/55/30/wKjmqlaPVeaAB-IoAAAB7WVkDXo4093018"/>                         <span class="up-count">{{upvotes}}</span>                         <img class="icon-coments" src="http://pic.kuaizhan.com/g2/M01/55/13/CgpQVFaPVeeAZM41AAAB7k4v0JA9069319"/>                         <span class="replies-count">{{replies}}</span>',v='{{#open_reward}}                             <span class="reward-count-theme4">{{tips}}赏</span>                         {{/open_reward}}                         <span class="up-count-theme4">{{upvotes}}赞</span>                         <span class="replies-count-theme4">{{replies}}回应</span>',m='{{#time_tick}}                             <img class="tick-img" src="{{tick_img_src}}"/>                             {{#time_to_start}}<div class="{{^theme3}}time-info-span{{/theme3}} {{#theme3}}time-info-span-theme3{{/theme3}}">距活动开始 :</div><div class="time-tick-div {{^theme3}}start-time-div{{/theme3}} {{#theme3}}start-time-div-theme3{{/theme3}}" data-end_time="{{time_to_start}}"></div>{{/time_to_start}}                             {{#time_to_end}}<div class="{{^theme3}}time-info-span{{/theme3}} {{#theme3}}time-info-span-theme3{{/theme3}}">距活动结束 :</div><div class="time-tick-div {{^theme3}}end-time-div{{/theme3}} {{#theme3}}end-time-div-theme3{{/theme3}}" data-end_time="{{time_to_end}}"></div>{{/time_to_end}}                             {{#time_end}}<span class="time-info-span">活动已经结束</span>{{/time_end}}                         {{/time_tick}}                         {{#show_start_time}}<span class="info-span">时间</span><span class="start-time-span">{{start_time}}-{{end_time}}</span>{{/show_start_time}}<br/>                         {{#geo_address}}<span class="info-span">地点</span><span class="geo-address-span">{{geo_address}}</span>{{/geo_address}}',g='{{#has_topic_item}}            {{#one_forum_name}}                {{#show_forum_name}}                    {{#theme4}}                        <div class="forum-name-div forum-name-div-top-theme4" data-forum_id="{{forum_id}}">                            <div class="header-theme4-top">                                <span class="forum-name-span" >{{forum_name}}</span>                            </div>                        </div>                    {{/theme4}}                    {{^theme4}}                        <div class="forum-name-div" data-jump_url="{{jump_url}}" data-forum_id="{{forum_id}}">                            <div class="forum-name">                                <img class="forum-avatar-img" src="{{forum_avatar}}"/>                                <span class="forum-name-span" >{{forum_name}}</span>                            </div>                        </div>                    {{/theme4}}                {{/show_forum_name}}            {{/one_forum_name}}        {{/has_topic_item}}',y='{{#has_topic_item}}                    {{#items}}                        {{#theme1}}                            {{#is_activity}}                                <div class="one-item activity-item" data-jump_url="{{jump_url}}" data-forum_id="{{forum_id}}"  data-is_private="{{is_private}}" >                                    {{#has_forum_name}}                                        <div class="header">                                            <img class="forum-avatar-img" src="{{forum_avatar}}"/>                                            <span class="forum-name-span" >{{forum_name}}</span>                                        </div>                                    {{/has_forum_name}}                                    <div class="activity-header {{#has_forum_name}}activity-content-with-forum-name{{/has_forum_name}}">                                        <img class="activity-type-img" src="{{activity_type_img_src}}"/>                                        <span class="activity-header-span">{{activity_title}}</span>                                    </div>                                    <div class="activity-info">'+m+'</div>                                </div>                                {{/is_activity}}                            {{^is_activity}}                                {{#is_private}}                                    <div class="one-item private-item" data-jump_url="{{jump_url}}" data-forum_id="{{forum_id}}" data-is_private="{{is_private}}">                                        {{#has_forum_name}}                                            <div class="header">                                                <img class="forum-avatar-img" src="{{forum_avatar}}"/>                                                <span class="forum-name-span" >{{forum_name}}</span>                                            </div>                                        {{/has_forum_name}}                                        <div class="private-topic-content-div">                                            <div class="private-topic-content">                                                <span>该话题是私密话题,申请</span>                                                <a class="jump-url" href="{{jump_url}}">加入社区</a>                                                <span>后可阅读</span>                                            </div>                                        </div>                                        <div class="footer">'+c+'<span class="time-freshness">{{time_freshness}}</span>                                            <div class="footer-right">'+d+'</div>                                        </div>                                     </div>                                    {{/is_private}}                                {{^is_private}}                                    <div class="one-item" data-jump_url="{{jump_url}}" data-forum_id="{{forum_id}}" data-is_private="{{is_private}}">                                        {{#has_forum_name}}                                            <div class="header">                                                <img class="forum-avatar-img" src="{{forum_avatar}}"/>                                                <span class="forum-name-span" >{{forum_name}}</span>                                            </div>                                        {{/has_forum_name}}'+p+'<div class="footer {{footer_theme1}}">'+c+'<span class="time-freshness">{{time_freshness}}</span>                                            <div class="footer-right">'+d+'</div>                                        </div>                                    </div>                                {{/is_private}}                             {{/is_activity}}                        {{/theme1}}                        {{#theme2}}                            {{#is_activity}}                                <div class="one-item activity-item" data-jump_url="{{jump_url}}" data-forum_id="{{forum_id}}" data-is_private="{{is_private}}">                                    {{#has_forum_name}}                                        <div class="header">                                            <img class="forum-avatar-img" src="{{forum_avatar}}"/>                                            <span class="forum-name-span" >{{forum_name}}</span>                                        </div>                                    {{/has_forum_name}}                                    {{#activity_img_src}}                                        <div class="activity-pics {{#has_forum_name}}activity-pics-with-header{{/has_forum_name}}">                                            <img class="activity-img-theme2" src="{{activity_img_src}}"/>                                        </div>                                    {{/activity_img_src}}                                    <div class="activity-header">                                        <img class="activity-type-img" src="{{activity_type_img_src}}"/>                                        <span class="activity-header-span">{{activity_title}}</span>                                    </div>                                    <div class="activity-info">'+m+'</div>                                </div>                                {{/is_activity}}                            {{^is_activity}}                                {{#is_private}}                                    <div class="one-item private-item" data-jump_url="{{jump_url}}" data-forum_id="{{forum_id}}" data-is_private="{{is_private}}">                                        {{#has_forum_name}}                                            <div class="header">                                                <img class="forum-avatar-img" src="{{forum_avatar}}"/>                                                <span class="forum-name-span" >{{forum_name}}</span>                                            </div>                                        {{/has_forum_name}}                                        <div class="private-topic-content-div">                                            <div class="private-topic-content">                                                <span>该话题是私密话题,申请</span>                                                <a class="jump-url" href="{{jump_url}}">加入社区</a>                                                <span>后可阅读</span>                                            </div>                                        </div>                                        <div class="footer">'+c+'<span class="time-freshness">{{time_freshness}}</span>                                            <div class="footer-right">'+d+'</div>                                        </div>                                    </div>                                    {{/is_private}}                                {{^is_private}}                                    <div class="one-item" data-jump_url="{{jump_url}}" data-forum_id="{{forum_id}}" data-is_private="{{is_private}}">                                        {{#has_forum_name}}                                            <div class="header">                                                <img class="forum-avatar-img" src="{{forum_avatar}}"/>                                                <span class="forum-name-span" >{{forum_name}}</span>                                            </div>                                        {{/has_forum_name}}'+p+'{{#show_topic_pics}}                                            <div class="pics">                                                {{#topic_pics}}                                                    <div class="{{pic_theme}} {{#last_pic}}last-pic{{/last_pic}}">                                                        <img src="{{url}}"/>                                                        {{#is_video}}                                                             <img class="play-video-img" src="http://pic.kuaizhan.com/g1/M01/6F/48/wKjmqVbKe_SAJMoLAAAJPeS73ns1023014"/>                                                        {{/is_video}}                                                    </div>                                                {{/topic_pics}}                                                {{#show_pic_sum}}                                                    <div class="pic-sum-theme2">                                                        <img class="pic-sum-pic" src="http://pic.kuaizhan.com/g2/M01/55/01/wKjmqlaOXCaAJHMRAAACQLwK8zg4468286">                                                        <span class="pic-sum-span">{{pic_sum}}</span>                                                    </div>                                                {{/show_pic_sum}}                                            </div>                                        {{/show_topic_pics}}                                        <div class="footer {{footer_theme2}} ">'+h+'<span class="time-freshness">{{time_freshness}}</span>                                            <div class="footer-right">'+d+'</div>                                        </div>                                    </div>                                 {{/is_private}}                                {{/is_activity}}                        {{/theme2}}                        {{#theme3}}                            {{#is_activity}}                                <div class="one-item activity-item" data-jump_url="{{jump_url}}" data-forum_id="{{forum_id}}" data-is_private="{{is_private}}">                                    <div class="activity-theme3-content">                                            {{#activity_img_src}}                                            <div class="{{activity_img_theme}}">                                                <img src="{{activity_img_src}}"/>                                            </div>                                        {{/activity_img_src}}                                        <div class="right {{activity_content_theme}}">                                            {{#has_forum_name}}                                                <div class="header">                                                    <img class="forum-avatar-img" src="{{forum_avatar}}"/>                                                    <span class="forum-name-span" >{{forum_name}}</span>                                                </div>                                            {{/has_forum_name}}                                            <div class="activity-content {{#has_forum_name}}activity-content-with-forum-name{{/has_forum_name}}">                                                <div class="activity-header">                                                    <img class="activity-type-img" src="{{activity_type_img_src}}"/>                                                    <span class="activity-header-span">{{activity_title}}</span>                                                </div>                                                <div class="activity-info">'+m+'</div>                                            </div>                                        </div>                                    </div>                                </div>                            {{/is_activity}}                            {{^is_activity}}                                {{#is_private}}                                    <div class="one-item private-item" data-jump_url="{{jump_url}}" data-forum_id="{{forum_id}}" data-is_private="{{is_private}}">                                        {{#has_forum_name}}                                            <div class="header">                                                <img class="forum-avatar-img" src="{{forum_avatar}}"/>                                                <span class="forum-name-span" >{{forum_name}}</span>                                            </div>                                        {{/has_forum_name}}                                        <div class="private-topic-content-div">                                            <div class="private-topic-content">                                                <span>该话题是私密话题,申请</span>                                                <a class="jump-url" href="{{jump_url}}">加入社区</a>                                                <span>后可阅读</span>                                            </div>                                        </div>                                        <div class="footer">'+c+'<span class="time-freshness">{{time_freshness}}</span>                                            <div class="footer-right">'+d+'</div>                                        </div>                                    </div>                                {{/is_private}}                                {{^is_private}}                                    <div class="one-item" data-jump_url="{{jump_url}}" data-forum_id="{{forum_id}}" data-is_private="{{is_private}}">                                        {{#show_topic_pics}}                                            <div class="{{topic_pics_theme}}">                                                <div class="pics">                                                    {{#topic_pics}}                                                        <div class="one-pic">                                                            <img src="{{url}}"/>                                                            {{#is_video}}                                                                 <img class="play-video-img" src="http://pic.kuaizhan.com/g1/M01/6F/48/wKjmqVbKe_SAJMoLAAAJPeS73ns1023014"/>                                                            {{/is_video}}                                                        </div>                                                    {{/topic_pics}}                                                    {{#show_pic_sum}}                                                        <div class="pic-sum-theme3">                                                            <img class="pic-sum-pic" src="http://pic.kuaizhan.com/g2/M01/55/01/wKjmqlaOXCaAJHMRAAACQLwK8zg4468286">                                                            <span class="pic-sum-span">{{pic_sum}}</span>                                                        </div>                                                    {{/show_pic_sum}}                                                </div>                                            </div>                                        {{/show_topic_pics}}                                        <div class="right {{topic_content_theme}}">                                            {{#has_forum_name}}                                                <div class="header">                                                    <img class="forum-avatar-img" src="{{forum_avatar}}"/>                                                    <span class="forum-name-span" >{{forum_name}}</span>                                                </div>                                            {{/has_forum_name}}'+p+'<div class="footer  {{footer_theme3}}">'+h+'<span class="time-freshness">{{time_freshness}}</span>                                                <div class="footer-right">'+d+'</div>                                            </div>                                        </div>                                        </div>                                    {{/is_private}}                               {{/is_activity}}                        {{/theme3}}                        {{#theme4}}                            {{#is_activity}}                                <div class="one-item activity-item {{^has_forum_name}}one-item-without-name{{/has_forum_name}}{{#has_forum_name}}one-item-with-name{{/has_forum_name}}" data-jump_url="{{jump_url}}" data-forum_id="{{forum_id}}">                                    <div class="topic-content-theme4 {{#has_forum_name}}margin-top-theme4{{/has_forum_name}}">                                        {{#attachment_type}}                                            <span class="left-sep">|</span>                                            <span class="attachment-type-span">{{attachment_type}}</span>                                            <span class="right-sep">|</span>                                        {{/attachment_type}}                                        <span class="content-span bolder-span">{{content}}</span>                                    </div>                                    {{#has_forum_name}}                                        <div class="forum-name-div-theme4" data-forum_id="{{forum_id}}">                                            <div class="header header-theme4">                                                <span class="forum-name-span" >{{forum_name}}</span>                                            </div>                                            <div class="footer-right-theme4">'+v+'</div>                                        </div>                                    {{/has_forum_name}}                                </div>                                {{/is_activity}}                            {{^is_activity}}                                {{#is_private}}                                    <div class="one-item {{^has_forum_name}}one-item-without-name{{/has_forum_name}}{{#has_forum_name}}one-item-with-name{{/has_forum_name}}" data-jump_url="{{jump_url}}" data-forum_id="{{forum_id}}">                                        <div class="topic-content-theme4 {{#has_forum_name}}margin-top-theme4{{/has_forum_name}}">                                            {{#attachment_type}}                                                <span class="left-sep">|</span>                                                <span class="attachment-type-span">{{attachment_type}}</span>                                                <span class="right-sep">|</span>                                            {{/attachment_type}}                                            <span class="content-span">该话题是私密话题，</span>                                            <a class="jump-url  jump-url-theme4" href="{{jump_url}}">加入</a>                                            <span class="content-span">后方可查看</span>                                        </div>                                        {{#has_forum_name}}                                            <div class="forum-name-div-theme4" data-forum_id="{{forum_id}}">                                                <div class="header header-theme4">                                                    <span class="forum-name-span" >{{forum_name}}</span>                                                </div>                                                <div class="footer-right-theme4">'+v+'</div>                                            </div>                                        {{/has_forum_name}}                                     </div>                                    {{/is_private}}                                {{^is_private}}                                    <div class="one-item {{^has_forum_name}}one-item-without-name{{/has_forum_name}}{{#has_forum_name}}one-item-with-name{{/has_forum_name}}" data-jump_url="{{jump_url}}" data-forum_id="{{forum_id}}">                                        <div class="topic-content-theme4 {{#has_forum_name}}margin-top-theme4{{/has_forum_name}}">                                            {{#attachment_type}}                                                <span class="left-sep">|</span>                                                <span class="attachment-type-span">{{attachment_type}}</span>                                                <span class="right-sep">|</span>                                            {{/attachment_type}}                                            <span class="content-span {{#bolder}}bolder-span{{/bolder}}">{{content}}</span>                                        </div>                                        {{#has_forum_name}}                                            <div class="forum-name-div-theme4" data-forum_id="{{forum_id}}">                                                <div class="header header-theme4">                                                    <span class="forum-name-span" >{{forum_name}}</span>                                                </div>                                                <div class="footer-right-theme4">'+v+'</div>                                            </div>                                        {{/has_forum_name}}                                    </div>                                {{/is_private}}                             {{/is_activity}}                        {{/theme4}}                    {{/items}}                {{/has_topic_item}}                {{^has_topic_item}}                    <div class="empty-topic-list">                        <div class="default-word">                            <span class="empty-word">暂无话题</span>                        </div>                    </div>                {{/has_topic_item}}',b='<div class="private-forum" data-jump_url="{{jump_url}}" data-forum_id="{{forum_id}}" data-is_private="{{is_private}}">            {{#one_forum_name}}                {{#show_forum_name}}                    <div class="header">                        <img class="forum-avatar-img" src="{{forum_avatar}}"/>                        <span class="forum-name-span" >{{forum_name}}</span>                    </div>                    <div class="forum-info-div">                        <span class="forum-topics-span" >话题</span>                        <span class="forum-topics" >{{private_forum_topics}}</span>                        <span class="forum-visits-span" >访问数</span>                        <span class="forum-visits" >{{private_forum_visits}}</span>                    </div>                {{/show_forum_name}}            {{/one_forum_name}}            <div class="private-forum-content-div">                <div class="private-forum-content">                <span>该话题是私密社区,</span>                <a class="jump-url" href="{{jump_url}}">加入该社区</a>                <span>后可阅读帖子</span>                </div>            </div>        </div>',w='{{#has_more}}            <div class="more-topic-list">                <a type="button" class="js-add-more-list add-more-list" href="javascript:;">点击加载更多</a>            </div>        {{/has_more}}',E=function(t){return String(t).replace(/[&<>"'\/]/g,function(e){return n[e]})},S=function(t){return e("<div/>").html(t).text()},x=function(t){return e("<div/>").text(t).html()},T=function(n){if(n.forum_id){var r="/club/apiv1/forums/"+n.forum_id;e.ajax({url:r,type:"GET",dataType:"json",success:function(e){n.callback(e)}})}},N=function(n){if(n.forum_id){var r="/club/apiv1/forums/"+n.forum_id+"/topics?offset="+n.offset+"&limit="+n.limit+"&sort="+n.sort;n.is_passed&&n.tag_id!=0?n.tag_id==-2?r+="&state=400":r=r+"&tag_id="+n.tag_id+"&is_passed=true":r+="&with_stickings=false&with_announcements=false",e.ajax({url:r,type:"GET",dataType:"json",success:function(e){n.callback(e)},error:function(e){n.callback(JSON.parse(e.response))}})}else n.callback([])},C=function(n){if(n.forum_id){var r="/club/apiv1/forums/"+n.forum_id+"/topics-count";n.is_passed&&n.tag_id!=0&&(n.tag_id=="-2"?r+="?state=400":r=r+"?tag_id="+n.tag_id+"&is_passed=true"),e.ajax({url:r,type:"GET",dataType:"json",success:function(e){n.callback(e)},error:function(){console.log("get some topic list error")}})}else n.callback([])},k=function(n){var r="/club/apiv1/sites/"+n.site_id+"/topics?force=True&offset="+n.offset+"&limit="+n.limit+"&sort="+n.sort;n.is_passed&&n.tag_id!=0?n.tag_id==-2?r+="&state=400":r=r+"&tag_id="+n.tag_id+"&is_passed=true":r+="&with_stickings=false&with_announcements=false",e.ajax({url:r,type:"GET",dataType:"json",success:function(e){n.callback(e)},error:function(){console.log("get all topic list error")}})},L=function(n){var r="/club/apiv1/sites/"+n.site_id+"/topics-count";n.is_passed&&n.tag_id!=0&&(n.tag_id=="-2"?r+="?state=400":r=r+"?tag_id="+n.tag_id+"&is_passed=true"),e.ajax({url:r,type:"GET",dataType:"json",success:function(e){n.callback(e)},error:function(){console.log("get all topic list error")}})},A=function(n,c,h){var p=[],d={},v={},m=c.datas,E=!0;m.code&&m["code"]==20400&&(E=!1);if(m){m.length!=0?v.has_topic_item=!0:v.has_topic_item=!1;var S=new Date,T=S.getTime(),N=T/1e3,C=c.theme3?1:4,k=!1;c.show_forum_name&&!c.select_forum_type&&(k=!0);for(var L=0,A=m.length;L<A;L++){var O=m[L].forum;c.select_forum_type&&(O=h);if(!O)continue;d={},d.is_private=m[L].is_content_hidden,d.has_forum_name=k,d.theme1=c.theme1,d.theme2=c.theme2,d.theme3=c.theme3,d.theme4=c.theme4;var M=[],D=m[L].audios?m[L].audios:[],P=m[L].videos?m[L].videos:[],H=Math.ceil((new Date(m[L].ctime)).getTime()/1e3)-28800,B=m[L].attachments,j=m[L].freshness,F=m[L].tag_ids,I=m[L].counts,q=m[L].forum_id,R=new Date(m[L].start_time),U=new Date(m[L].end_time),z=0,W=0,X=0;c["sort_method"]=="ctime"&&(j=H);var V=(N-j)/60,$=V/60,J=$/24;V<60?d.time_freshness=parseInt(V)+"分钟前":V>60&&1<$&&$<24?d.time_freshness=parseInt($)+"小时前":d.time_freshness=parseInt(J)+"天前",c.select_forum_type||(c.show_forum_name?d.activity_content_theme="activity-right-with-left-four left-with-forum-name":d.activity_content_theme="activity-right-with-left-four left-without-forum-name"),I&&(d.upvotes=I.upvotes),I&&(d.replies=I.replies),I&&(d.participants=I.participants),I&&(d.tips=I.tips?I.tips:0),d.show_topic_pics=!1;for(var K=0,Q=F.length;K<Q;K++){if(F[K]=="ACTIVITY"){d.is_activity=!0,d.attachment_type="活动",d.activity_type_img_src=l,d.show_start_time=!0,B[0]&&(c.theme2?d.activity_img_src=B[0].url+"/imageView/v1/thumbnail/640x360":d.activity_img_src=B[0].url+"/imageView/v1/thumbnail/320x320"),T<R.getTime()?(d.participants="活动尚未开始",d.activity_theme="activity-theme-not-open"):T>U.getTime()?(d.participants="活动已结束",d.activity_theme="activity-theme-close"):T>=R.getTime()&&T<=U.getTime()&&(m[L].is_participated?(d.participants="我已参与("+d.participants+"人)",d.activity_theme="activity-theme-participated"):I.participants<m[L].max_participants?(d.participants="我要参与("+d.participants+"人)",d.activity_theme="activity-theme-to-participate"):(d.participants="报名人数已满("+d.participants+"人)",d.activity_theme="activity-theme-full"));break}if(F[K]=="PIC_SHOW"){d.is_activity=!0,d.attachment_type="晒图",d.activity_type_img_src=a,d.show_start_time=!0,B[0]&&(c.theme2?d.activity_img_src=B[0].url+"/imageView/v1/thumbnail/640x360":d.activity_img_src=B[0].url+"/imageView/v1/thumbnail/320x320"),T<R.getTime()?(d.participants="活动尚未开始",d.activity_theme="activity-theme-not-open"):T>U.getTime()?(d.participants="活动已结束",d.activity_theme="activity-theme-close"):T>=R.getTime()&&T<=U.getTime()&&(m[L].is_participated?(d.participants="我已参与("+d.participants+"人)",d.activity_theme="activity-theme-participated"):(d.participants="立即参与("+d.participants+"人)",d.activity_theme="activity-theme-to-participate"));break}if(F[K]=="VOTE"){d.is_activity=!0,d.activity_type_img_src=f,d.attachment_type="投票",d.time_tick=!0,d.show_start_time=!1,d.tick_img_src=u,B[0]&&(c.theme2?d.activity_img_src=B[0].url+"/imageView/v1/thumbnail/640x360":d.activity_img_src=B[0].url+"/imageView/v1/thumbnail/320x320"),T<R.getTime()?d.time_to_start=R.getTime():T>=U.getTime()?d.time_end=!0:d.time_to_end=U;break}F[K]=="ANNOUNCEMENT"?(d.attachment_type="公告",d.bolder=!0):d.attachment_type=null}m[L]["enable_reward"]==1||O["enable_reward"]==1?d["attachment_type"]!="活动"&&d["attachment_type"]!="晒图"?d.open_reward=!0:d.open_reward=!1:d.open_reward=!1,d.is_private&&(d.is_activity=!1,d.attachment_type="私密话题");for(var K=0;K<P.length;K++)if(P[K]["state"]!=-999){z++;var G={};G.url=P[K].url+"/imageView/v1/thumbnail/320x320",!c.select_forum_type&&c.show_forum_name?G.pic_theme="one-pic-theme2-all-forum":G.pic_theme="one-pic-theme2-all-forum",G.is_video=!0,M.push(G),d["attachment_type"]==null&&(d.attachment_type="视频"),d.show_topic_pics=!0,!c.select_forum_type&&c.show_forum_name?d.activity_content_theme="activity-right-with-left-four left-with-forum-name":d.activity_content_theme="activity-right-with-left-four left-without-forum-name"}for(var K=0;K<D.length;K++)D[K]["state"]!=-999&&(W++,d["attachment_type"]==null&&(d.attachment_type="音频"));for(var K=0;K<B.length;K++)if(B[K]["type"]==1){X++;if(X<=C-z){var G={};G.url=B[K].url+"/imageView/v1/thumbnail/320x320",X==C-z&&(G.last_pic=!0),!c.select_forum_type&&c.show_forum_name?G.pic_theme="one-pic-theme2-all-forum":G.pic_theme="one-pic-theme2-all-forum",M.push(G),d["attachment_type"]==null&&(d.attachment_type="图片"),d.show_topic_pics=!0,!c.select_forum_type&&c.show_forum_name?d.activity_content_theme="activity-right-with-left-four left-with-forum-name":d.activity_content_theme="activity-right-with-left-four left-without-forum-name"}}z+X>C?d.show_pic_sum=!0:d.show_pic_sum=!1,d.has_image_type_pic=X!=0?!0:!1,d.has_audio_type_pic=W!=0?!0:!1,d.has_video_type_pic=z!=0?!0:!1,d.has_media_type_pic=m[L]["brief"]!=m[L]["content"]?!0:!1,d.image_type_pic=r,d.audio_type_pic=i,d.video_type_pic=s,d.media_type_pic=o,d.image_is_last_img=!(d.has_audio_type_pic||d.has_video_type_pic||d.has_media_type_pic),d.audio_is_last_img=!d.has_video_type_pic&&!d.has_media_type_pic,d.video_is_last_img=!d.has_media_type_pic,d.media_is_last_img=d.has_media_type_pic,!c.select_forum_type&&c.show_forum_name?(d.activity_img_theme="activity-left-four left-with-forum-name",d.topic_pics_theme="left-four",d.topic_content_theme="right-with-left-four"):(d.activity_img_theme="activity-left-four left-without-forum-name",d.topic_pics_theme="left-four",d.topic_content_theme="right-with-left-four"),M.length==0&&(d.topic_content_theme=""),d.pic_sum=z+X,d.activity_title=m[L].title,O&&(d.forum_name=O.title),O&&(d.forum_avatar=O.avatar),d.topic_pics=M,c.theme4?m[L].title?(d.content=x(m[L].title),d.bolder=!0):d.content=x(m[L].brief):m[L].title?(d.topic_title=x(m[L].title),d.topic_content=x(m[L].brief)):d.topic_content=x(m[L].brief);if(d.topic_title||d.topic_content)d.has_topic_content=!0;d.geo_address=m[L].geo_address,d.start_time=R.getFullYear()+"."+(R.getMonth()+1)+"."+R.getDate(),d.end_time=U.getFullYear()+"."+(U.getMonth()+1)+"."+U.getDate(),d.show_forum_name=c.show_forum_name,d.jump_url="/club/apiv1/topics/"+m[L]._id+"/jump-to",d.forum_id=q,!m[L].brief&&m[L].content&&d["topic_pics"].length==0&&(d.attachment_type="点击查看话题详情"),!d.is_activity&&M.length==1&&d.theme2&&(d.theme2=!1,d.theme3=!0),d.theme1?d.footer_theme1="footer-with-content":d.theme2?d.footer_theme2="footer-with-content":d.theme3&&(d["topic_pics"].length!=0?d.footer_theme3="footer-with-pics":d.footer_theme3="footer-with-content"),p.push(d)}}v.items=p,v.cur_count=c.offset+c.limit,c.show_more_topic&&c.topic_count>c.offset+c.limit?v.has_more=!0:(v.has_more=!1,n.find(".more-topic-list").empty()),v.show_forum_name=c.show_forum_name,c.select_forum_type?(v.one_forum_name=!0,v.forum_avatar=h.avatar,v.forum_name=h.title,v.forum_id=h._id):v.one_forum_name=!1,c.select_forum_type&&h["openness"]==200&&!E?(v.private_forum_topics=h.counts.topics,v.private_forum_visits=h.counts.visits,v.jump_url="/club/apiv1/forums/"+h._id+"/jump-to",n.find(".topiclist-name-div").empty(),n.find(".topiclist-div").append(t.render(b,v)),n.find(".topiclist-div").data("cur_count",v.cur_count)):(n.find(".topiclist-name-div").html(t.render(g,v)),n.find(".topiclist-div").append(t.render(y,v)),n.find(".topiclist-div").data("cur_count",v.cur_count)),v.has_more&&n.find(".more-topic-list").length==0&&n.find(".topiclist-content-div").append(t.render(w,v));var Y=n.find(".time-tick-div");if(Y.length>0)for(var L=0,A=Y.length;L<A;L++)_(Y[L])},O=function(e,t){var n=t.limit;t.select_forum_type?T({forum_id:t.select_forum_id,callback:function(r){N({forum_id:t.select_forum_id,is_passed:t.topic_tag_selected,tag_id:t.topic_tag_id,sort:t.sort_method,offset:t.offset,limit:n,callback:function(n){t.datas=n,A(e,t,r)}})}}):k({site_id:SOHUZ.page.site_id,is_passed:t.topic_tag_selected,tag_id:t.topic_tag_id,sort:t.sort_method,offset:t.offset,limit:n,callback:function(n){t.datas=n,A(e,t,{})}})},M=function(e,t){var n='<div class="topiclist-name-div"></div>';e.find(".topiclist-content-div").append(n);var r='<div class="topiclist-div" data-cur_count="0"></div>';e.find(".topiclist-content-div").append(r)},_=function(t){setInterval(function(){var n=e(t).data("end_time"),r=new Date(n),i=new Date,s=r.getTime()-i.getTime(),o=Math.floor(s/1e3/60/60/24),u=Math.floor(s/1e3/60/60%24),a=Math.floor(s/1e3/60%60),f=Math.floor(s/1e3%60);u<10&&(u="0"+u),a<10&&(a="0"+a),f<10&&(f="0"+f);var l="<span class='time-span'>"+o+"</span><span class='text-span'>天</span>"+"<span class='time-span'>"+u+"</span><span class='text-span'>时</span>"+"<span class='time-span'>"+a+"</span><span class='text-span'>分</span>"+"<span class='time-span'>"+f+"</span><span class='text-span'>秒</span>";e(t).html(l)},1e3)};return{onAfterRender:function(t){var n=e(t),r=SOHUZ.page.site_id,i=e(t).data("theme1"),s=e(t).data("theme2"),o=e(t).data("theme3"),u=e(t).data("theme4"),a=e(t).data("select_forum_type"),f=e(t).data("select_forum_id"),l=e(t).data("topic_tag_selected"),c=e(t).data("topic_tag_id"),h=e(t).data("sort_method"),p=e(t).data("topic_num"),d=e(t).data("show_forum_name"),v=e(t).data("show_more_topic"),m={};m.theme1=i,m.theme2=s,m.theme3=o,m.theme4=u,m.select_forum_type=a,m.select_forum_id=f,m.topic_tag_selected=l,m.topic_tag_id=c,m.sort_method=h,m.topic_num=p,m.show_forum_name=d,m.show_more_topic=v,m.offset=0,m.limit=p!=-1?p:20;var g=n.find(".time-tick-div");if(g.length>0)for(var y=0,b=g.length;y<b;y++)_(g[y]);a?C({forum_id:f,is_passed:l,tag_id:c,callback:function(e){m.topic_count=e,SOHUZ.page.mode=="preview"&&(M(n,m),O(n,m))}}):L({site_id:SOHUZ.page.site_id,is_passed:l,tag_id:c,callback:function(e){m.topic_count=e,SOHUZ.page.mode=="preview"&&(M(n,m),O(n,m))}}),n.on("click",".one-item",function(t){t.preventDefault();var n=e(this).data("is_private");if(n){var i=e(this).data("forum_id");SOHUZ.page.mode!="preview"&&kaq&&(kaq("create",r),kaq("set","type","clickForum"),kaq("send","event","system_plugin","click","topiclist",1)),window.location.href="/club/apiv1/forums/"+i+"/jump-to"}else{var s=e(this).data("jump_url");SOHUZ.page.mode!="preview"&&kaq&&(kaq("create",r),kaq("set","type","clickTopic"),kaq("send","event","system_plugin","click","topiclist",1)),window.location.href=s}}),n.on("click",".private-forum",function(t){t.preventDefault();var n=e(this).data("jump_url");SOHUZ.page.mode!="preview"&&kaq&&(kaq("create",r),kaq("set","type","clickTopic"),kaq("send","event","system_plugin","click","topiclist",1)),window.location.href=n}),n.on("click",".activity-item",function(t){t.preventDefault();var n=e(this).data("jump_url");SOHUZ.page.mode!="preview"&&kaq&&(kaq("create",r),kaq("set","type","clickTopic"),kaq("send","event","system_plugin","click","topiclist",1)),window.location.href=n}),n.on("click",".one-item .jump-url",function(t){t.preventDefault();var n=e(this).parents(".one-item").data("forum_id");SOHUZ.page.mode!="preview"&&kaq&&(kaq("create",r),kaq("set","type","clickForum"),kaq("send","event","system_plugin","click","topiclist",1)),window.location.href="/club/apiv1/forums/"+n+"/jump-to"}),n.on("click",".one-item .header",function(t){t.preventDefault();var n=e(this).parents(".one-item").data("forum_id");SOHUZ.page.mode!="preview"&&kaq&&(kaq("create",r),kaq("set","type","clickForum"),kaq("send","event","system_plugin","click","topiclist",1)),window.location.href="/club/apiv1/forums/"+n+"/jump-to"}),n.on("click",".forum-name-div",function(t){t.preventDefault();var n=e(this).data("forum_id");SOHUZ.page.mode!="preview"&&kaq&&(kaq("create",r),kaq("set","type","clickForum"),kaq("send","event","system_plugin","click","topiclist",1)),window.location.href="/club/apiv1/forums/"+n+"/jump-to"}),n.on("click",".js-add-more-list",function(){var e=parseInt(n.find(".topiclist-div").data("cur_count"));m.limit=10,SOHUZ.page.mode!="preview"&&kaq&&(kaq("create",r),kaq("set","type","clickMore"),kaq("send","event","system_plugin","click","topiclist",1)),m.offset=e,O(n,m)})}}})})(window,document,null,null);